import{r as g,a as l,j as e}from"./jsx-runtime-7cf68bf7.js";import{u as U,L as h,q,bf as k,M as L,bg as b,Q as O,a1 as D,a2 as E,bh as R,ax as V,a8 as $,o as _,bi as Y,bj as j,ac as F,b as T,ad as G,f as w,ah as H,C as x,bk as y,bl as B,aa as W}from"./Phone-ec5c0d3e.js";function X(){const{Func:N,Data:v}=g.useContext(M),a=U(b),[s,S]=g.useState(""),[o]=v;return l("div",{className:"slide right",children:[e("div",{className:"music-header",children:l("div",{className:"search",children:[e("div",{className:"title",children:h("APPS.MUSIC.SEARCH")}),e(q,{placeholder:h("APPS.MUSIC.SEARCH_PLACEHOLDER"),onChange:t=>S(t.target.value)})]})}),e("div",{className:"music-body",children:e("div",{className:"search-results",children:s.length>0&&Object.keys(o).map(t=>Object.keys(o[t]).filter(n=>{switch(t){case"Artists":return n.toLowerCase().includes(s.toLowerCase());case"Albums":return n.toLowerCase().includes(s.toLowerCase());case"Songs":return o[t][n].Title.toLowerCase().includes(s.toLowerCase())}}).map((n,r)=>{var u;let i;return t==="Songs"&&(i=((u=a==null?void 0:a.song)==null?void 0:u.Path)===o[t][n].Path),l("div",{className:"item","data-playing":i,onClick:()=>{t==="Songs"?N.play({song:o[t][n],queue:[...o.Songs.filter((d,m)=>o[t][n].Path!==d.Path&&m>r)]}):N.fetchAndSet(n,t)},children:[l("div",{className:"item-info",children:[e("img",{src:(t==="Artists"?o[t][n].Avatar:o[t][n].Cover)??"./assets/img/icons/music/unknown.png","data-artist":t==="Artists"}),l("div",{className:"text",children:[e("div",{className:"title",children:t==="Songs"?o[t][n].Title:n}),l("div",{className:"subtitle",children:[t==="Artists"&&h("APPS.MUSIC.ARTIST"),t==="Albums"&&`${h("APPS.MUSIC.ALBUM")} • ${o[t][n].Artist}`,t==="Songs"&&`${h("APPS.MUSIC.SONG")} • ${o[t][n].Artist}`]})]})]}),e("div",{className:"item-actions",children:t==="Songs"?e(k,{onClick:d=>{d.stopPropagation(),N.setContext(o[t][n])}}):e(L,{})})]})}))})})]})}function z(){const{View:N,SelectedData:v,Func:a}=g.useContext(M),s=U(b),[S,o]=N,[t]=v;return e("div",{className:"slide left",children:e("div",{className:"music-body",children:l("div",{className:"artist-profile",children:[l("div",{className:"avatar",style:{backgroundImage:`url(${t.Avatar})`},children:[e("div",{className:"top",children:e(O,{onClick:()=>o("search")})}),e("div",{className:"title",children:t.Name})]}),l("div",{className:"category",children:[l("div",{className:"title",children:[h("APPS.MUSIC.SONGS"),e(L,{})]}),e("section",{children:t.songs.map((n,r)=>{var u;let i=((u=s==null?void 0:s.song)==null?void 0:u.Path)===n.Path;return l("div",{className:"song","data-playing":i,onClick:()=>{a.play({song:n,queue:[...t.songs.filter((d,m)=>m>r)]})},children:[l("div",{className:"song-info",children:[e("img",{src:n.Cover??"./assets/img/icons/music/unknown.png",alt:""}),l("div",{className:"text",children:[e("div",{className:"title",children:n.Title}),n.Album&&e("div",{className:"subtitle",children:n.Album})]})]}),e(k,{onClick:d=>{d.stopPropagation(),a.setContext(n)}})]},r)})})]}),l("div",{className:"category",children:[l("div",{className:"title",children:[h("APPS.MUSIC.ALBUMS"),e(L,{})]}),e("section",{className:"albums",children:t.albums.map((n,r)=>l("div",{className:"album",onClick:()=>{a.fetchAndSet(n.Title,"Albums")},children:[e("img",{src:n.Cover,alt:""}),e("div",{className:"title",children:n.Title})]},r))})]})]})})})}function Q(){var r,i,u,d;const{View:N,Player:v}=g.useContext(M),a=U(b),[s,S]=N,[o,t]=v;let n=[{icon:e(E,{}),value:"library",label:h("APPS.MUSIC.LIBRARY")},{icon:e(R,{}),value:"search",label:h("APPS.MUSIC.SEARCH")}];return l("div",{className:"music-footer",children:[l("div",{className:"music-playing",onClick:()=>{a&&t(!0)},children:[l("div",{className:"song-info",children:[e("img",{src:((r=a==null?void 0:a.song)==null?void 0:r.Cover)??"./assets/img/icons/music/unknown.png",alt:""}),l("div",{className:"text",children:[e("div",{className:"title",children:((i=a==null?void 0:a.song)==null?void 0:i.Title)??h("APPS.MUSIC.NOT_PLAYING")}),((u=a==null?void 0:a.song)==null?void 0:u.Artist)&&e("div",{className:"subtitle",children:(d=a==null?void 0:a.song)==null?void 0:d.Artist})]})]}),e("div",{className:"controls",onClick:m=>{m.stopPropagation(),a&&b.patch({playing:!a.playing})},children:a&&a.playing?e(D,{}):e(E,{})})]}),e("div",{className:"items",children:n.map((m,I)=>l("div",{className:"item","data-active":s===m.value,onClick:()=>S(m.value),children:[m.icon,m.label]},I))})]})}function J(){var I,c,P,f;const{View:N,Player:v}=g.useContext(M),a=U(T.Settings),s=U(b),[S,o]=v,[t,n]=g.useState(!1),[r,i]=g.useState(null),[u,d]=g.useState("rgb(170, 170, 170)");g.useEffect(()=>{var C;s&&((C=s==null?void 0:s.song)!=null&&C.Cover)&&V(s.song.Cover).then(p=>{p&&d(`
                    linear-gradient(0deg,
                        ${p.dominant} 0%,
                        ${p.average} 50%,
                        ${p.muted} 100%
                    )
                `)})},[(I=s==null?void 0:s.song)==null?void 0:I.Cover]);const m=C=>{if(!C)return"0:00";let p=Math.floor(C/60),A=Math.floor(C-p*60);return A=A<10?"0"+A:A,p+":"+A};return l($.div,{className:"music-player",style:{background:u},initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{duration:.3},children:[e("div",{className:"music-player-header",onClick:()=>o(!1)}),l("div",{className:"music-player-body",children:[e("img",{className:"cover",src:((c=s==null?void 0:s.song)==null?void 0:c.Cover)??"./assets/img/icons/music/unknown.png"}),l("div",{className:"song-info",children:[e("div",{className:"title",children:((P=s==null?void 0:s.song)==null?void 0:P.Title)??h("APPS.MUSIC.NOT_PLAYING")}),e("div",{className:"subtitle",children:((f=s==null?void 0:s.song)==null?void 0:f.Artist)??""})]}),l("div",{className:"duration",children:[e(_,{type:"range",min:0,max:100,value:s?r||((s==null?void 0:s.current)??0/(s==null?void 0:s.duration)??0)*100:0,style:{background:s!=null&&s.current?`linear-gradient(to right, rgb(255, 255, 255) 0%, rgb(255, 255, 255) ${Math.floor(r||s.current/s.duration*100)}%, rgba(255, 255, 255, 0.3) ${Math.floor(r||s.current/s.duration*100)}%, rgba(255, 255, 255, 0.3) 100%)`:"rgba(255, 255, 255, 0.3)"},onMouseDown:()=>n(!0),onMouseUp:C=>{n(!1),r&&s&&(s.goTo(s.duration/100*r),i(null))},onChange:C=>i(C.target.value)}),l("div",{className:"time",children:[e("div",{className:"current",children:m(r?(s==null?void 0:s.duration)/100*r:s==null?void 0:s.current)}),e("div",{className:"total",children:m(s==null?void 0:s.duration)})]})]}),l("div",{className:"controls",children:[e(Y,{onClick:()=>s==null?void 0:s.previous()}),e("div",{className:"play",onClick:()=>{s&&b.patch({playing:!s.playing})},children:s!=null&&s.playing?e(D,{}):e(E,{})}),e(j,{onClick:()=>s==null?void 0:s.next()})]}),l("div",{className:"volume",children:[e(F,{}),e(_,{type:"range",min:0,max:1,step:.05,style:{background:`linear-gradient(to right, rgb(255, 255, 255) 0%, rgb(255, 255, 255) ${a.sound.volume*100}%, rgba(255, 255, 255, 0.3) ${a.sound.volume*100}%, rgba(255, 255, 255, 0.3) 100%)`},value:a.sound.volume,onChange:C=>{T.Settings.patch({sound:{...T.Settings.value.sound,volume:C.target.value}})}}),e(G,{})]})]})]})}function K(){const{Func:N,Data:v}=g.useContext(M),[a,s]=g.useState(""),[S]=v,[o,t]=g.useState([]);return g.useEffect(()=>{w("Music",{action:"getPlaylists"}).then(n=>{n&&t(n.map(r=>({...r,Songs:r.Songs.map(i=>{var u;return{...S.Songs.find(d=>d.Path===i),Cover:(u=S.Songs.find(d=>d.Path===i&&(S.Albums[d.Album]??S.Songs[i])))==null?void 0:u.Cover,Path:i}})})))})},[]),l("div",{className:"slide right",children:[e("div",{className:"music-header",children:l("div",{className:"space",children:[e("div",{className:"title",children:h("APPS.MUSIC.LIBRARY")}),e(H,{onClick:()=>{x.PopUp.set({title:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.TITLE"),description:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.DESCRIPTION"),input:{placeholder:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.PLACEHOLDER"),type:"text",minCharacters:1,onChange:n=>s(n)},buttons:[{title:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.CANCEL")},{title:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.PROCEED"),cb:()=>{s(n=>(w("Music",{action:"createPlaylist",name:n}).then(r=>{r&&t(i=>[...i,{id:r,Title:n,Songs:[]}])}),n))}}]})}})]})}),e("div",{className:"music-body",children:e("div",{className:"library",children:o.map((n,r)=>l("div",{className:"playlist",onClick:()=>{N.fetchAndSet(n,"playlist",!0)},children:[l("div",{className:"playlist-details",children:[n.Cover?e("img",{src:n.Cover??"./assets/img/icons/music/unknown.png"}):n.Songs.length>0?e("div",{className:"playlist-cover","data-grid":n.Songs.filter(i=>i.Cover).length>=4,children:n.Songs.filter(i=>i.Cover).length>=4?n.Songs.filter((i,u)=>u<4).map((i,u)=>e("img",{src:i.Cover})):e("img",{src:n.Songs[0].Cover??"./assets/img/icons/music/unknown.png"})}):e("img",{src:"./assets/img/icons/music/unknown.png"}),l("div",{className:"text",children:[e("div",{className:"title",children:n.Title}),l("div",{className:"subtitle",children:[n.Songs.length," songs"]})]})]}),e(L,{})]},r))})})]})}function Z(){const{View:N,SelectedData:v,Func:a}=g.useContext(M),s=U(b),[S,o]=N,[t]=v,[n]=g.useState(!!t.Artist);return l("div",{className:"slide left",children:[e("div",{className:"music-header",children:l("div",{className:"space",children:[e(O,{onClick:()=>t.Artist?o("search"):o("library")}),!n&&e(y,{onClick:r=>{r.stopPropagation(),x.ContextMenu.set({buttons:[{title:h("APPS.MUSIC.DELETE_PLAYLIST"),color:"red",cb:()=>{w("Music",{action:"deletePlaylist",id:t.Id}).then(i=>{i&&o("library")})}}]})}})]})}),e("div",{className:"music-body",children:l("div",{className:"playlist-wrapper",children:[l("div",{className:"playlist-details",children:[t.Cover?e("img",{src:t.Cover}):t.Songs.length>0?e("div",{className:"playlist-cover","data-grid":t.Songs.filter(r=>r.Cover).length>=4,children:t.Songs.filter(r=>r.Cover).length>=4?t.Songs.filter((r,i)=>i<4).map((r,i)=>e("img",{src:r.Cover})):e("img",{src:t.Songs[0].Cover??"./assets/img/icons/music/unknown.png"})}):e("img",{src:"./assets/img/icons/music/unknown.png"}),l("div",{className:"text",children:[e("div",{className:"title",children:t.Title}),e("div",{className:"subtitle",children:n?t.Artist:`${Object.keys(t.Songs).length} ${h("APPS.MUSIC.SONGS").toLowerCase()}`})]}),l("div",{className:"buttons",children:[l("div",{className:"button",onClick:()=>{a.play({song:t.Songs[0],queue:[...t.Songs.filter((r,i)=>i>0)]})},children:[e(E,{})," ",h("APPS.MUSIC.PLAY")]}),l("div",{className:"button",onClick:()=>{a.play({song:t.Songs[Math.floor(Math.random()*t.Songs.length)],queue:[...t.Songs.filter((r,i)=>i>0)].sort(()=>Math.random()-.5)})},children:[e(B,{}),h("APPS.MUSIC.SHUFFLE")]})]})]}),e("div",{className:"playlist-tracks",children:t.Songs.map((r,i)=>{var d;let u=((d=s==null?void 0:s.song)==null?void 0:d.Path)===r.Path;return l("div",{className:"track","data-album":n,"data-playing":u,onClick:()=>{a.play({song:r,queue:[...t.Songs.filter((m,I)=>I>i)]})},children:[l("div",{className:"track-info",children:[n?e("div",{className:"index",children:i+1}):e("img",{src:r.Cover??"./assets/img/icons/music/unknown.png"}),l("div",{className:"text",children:[e("div",{className:"title",children:r.Title}),e("div",{className:"subtitle",children:n?t.Artist:r.Artist})]})]}),e(k,{onClick:m=>{m.stopPropagation(),a.setContext(r)}})]},i)})})]})})]})}function ee(){const{Data:N,Playlist:v}=g.useContext(M),[a,s]=v,[S,o]=N,[t,n]=g.useState([]);g.useEffect(()=>{w("Music",{action:"getPlaylists"}).then(i=>{i&&n(i.map((u,d)=>({...u,Songs:u.Songs.map(m=>{var I;return{...S.Songs.find(c=>c.Path===m),Cover:(I=S.Songs.find(c=>c.Path===m&&(S.Albums[c.Album]??S.Songs[m])))==null?void 0:I.Cover,Path:m}})})))})},[]);const r=(i,u)=>{!i||!u||w("Music",{action:"addSong",id:i,song:u}).then(d=>{d&&s(!1)})};return l($.div,{className:"add-playlist-container",initial:{opacity:0,y:"100%"},animate:{opacity:1,y:0},exit:{opacity:1,y:"100%"},children:[e("div",{className:"music-header",children:e("div",{className:"left",children:e(O,{onClick:()=>s(!1)})})}),e("div",{className:"music-body",children:e("div",{className:"library",children:t.map((i,u)=>l("div",{className:"playlist",onClick:()=>{i.Songs.includes(a.Path)?x.PopUp.set({title:h("APPS.MUSIC.SONG_EXISTS_POPUP.TITLE"),description:h("APPS.MUSIC.SONG_EXISTS_POPUP.DESCRIPTION"),buttons:[{title:h("APPS.MUSIC.SONG_EXISTS_POPUP.CANCEL")}]}):r(i.Id,a.Path)},children:[l("div",{className:"playlist-details",children:[i.cover?e("img",{src:i.Cover}):i.Songs.length>0?e("div",{className:"playlist-cover","data-grid":i.Songs.filter(d=>d.Cover).length>=4,children:i.Songs.filter(d=>d.Cover).length>=4?i.Songs.filter((d,m)=>m<4).map((d,m)=>e("img",{src:d.Cover})):e("img",{src:i.Songs[0].Cover})}):e("img",{src:"./assets/img/icons/music/unknown.png"}),l("div",{className:"text",children:[e("div",{className:"title",children:i.Title}),l("div",{className:"subtitle",children:[i.Songs.length," ",h("APPS.MUSIC.SONGS").toLowerCase()]})]})]}),e(L,{})]},u))})})]})}const M=g.createContext(null);function ne(){U(b);const[N,v]=g.useState("search"),[a,s]=g.useState([]),[S,o]=g.useState(null),[t,n]=g.useState(!1),[r,i]=g.useState(!1),u={search:e(X,{}),artist:e(z,{}),library:e(K,{}),playlist:e(Z,{})},d=(c,P,f)=>{if(c&&!(!a[P]&&!f))if(P==="Albums"){let C=Object.keys(a.Songs).filter(p=>a.Songs[p].Album===c).map(p=>a.Songs[p]);o({...a[P][c],Songs:C,Title:c}),v("playlist")}else if(P==="Artists"){let C=Object.keys(a.Songs).filter(A=>a.Songs[A].Artist===c).map(A=>a.Songs[A]),p=Object.keys(a.Albums).filter(A=>a.Albums[A].Artist===c).map(A=>({...a.Albums[A],Title:A}));o({...a[P][c],Name:c,songs:C,albums:p}),v("artist")}else P==="playlist"&&(o(c),v("playlist"))},m=c=>{var P,f;!c||!c.song||(b.value?b.patch({playing:!0,song:c.song,queue:c.queue??((P=b.value)==null?void 0:P.queue)??[]}):b.set({playing:!0,song:c.song,queue:c.queue??((f=b.value)==null?void 0:f.queue)??[]}))},I=c=>{if(!c)return;let P=[{title:h("APPS.MUSIC.ADD_QUEUE"),cb:()=>{b.patch({queue:[...b.value.queue,c]})}},{title:h("APPS.MUSIC.ADD_PLAYLIST"),cb:()=>{i(c)}}];S.IsOwner&&P.push({title:h("APPS.MUSIC.REMOVE_SONG"),color:"red",cb:()=>{w("Music",{action:"removeSong",id:S.Id,song:c.Path}).then(f=>{f&&o(C=>{let p=C.Songs.filter(A=>A.Path!==c.Path);return{...C,Songs:p}})})}}),x.ContextMenu.set({buttons:P})};return g.useEffect(()=>{w("Music",{action:"getConfig"}).then(c=>{if(!c)return;let P=Object.keys(c.Songs).map(f=>({...c.Songs[f],Cover:c.Songs[f].Album&&c.Albums[c.Songs[f].Album]?c.Albums[c.Songs[f].Album].Cover:c.Songs[f].Cover,Path:f}));s({...c,Songs:P})})},[]),e("div",{className:"music-container",children:l(M.Provider,{value:{View:[N,v],Data:[a,s],SelectedData:[S,o],Player:[t,n],Playlist:[r,i],Func:{fetchAndSet:d,play:m,setContext:I}},children:[l(W,{initial:!1,mode:"exit",children:[t&&e(J,{}),r&&e(ee,{})]}),u[N],e(Q,{})]})})}export{M as MusicContext,ne as default};
