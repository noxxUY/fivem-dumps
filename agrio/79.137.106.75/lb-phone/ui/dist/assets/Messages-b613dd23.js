var Ce=Object.defineProperty;var we=(t,n,d)=>n in t?Ce(t,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):t[n]=d;var ne=(t,n,d)=>(we(t,typeof n!="symbol"?n+"":n,d),d);import{r as S,a as o,j as e,F as J}from"./jsx-runtime-7cf68bf7.js";import{u as L,g as Q,L as c,C as Y,j as _,o as K,G as Ee,f as U,b as H,h as ie,H as W,J as Te,q as ge,K as Oe,M as Ge,N as z,O as Ue,Q as Ie,R as De,e as Le,T as Ne,U as re,V as ke,W as ve,X as me,B as ue,Y as ye,Z as he,_ as Re,$ as _e,a0 as Se,a1 as $e,a2 as Ve,i as Ye,A as He,a3 as je,I as Fe,k as xe,a4 as Xe}from"./Phone-ec5c0d3e.js";function Be(){const{User:t,View:n,Newmessage:d,ImportedUser:E}=S.useContext(B),[i,s]=t,[r,h]=n,[m,C]=E,g=L(H.PhoneNumber),[O,$]=d,M=L(ie.APPS.PHONE.contacts),[N,P]=S.useState([]),G=S.useRef(null),[b,w]=S.useState(""),[k,V]=S.useState([]),[v,A]=S.useState({content:"",attachments:[]});S.useEffect(()=>{m&&(P([m]),C(null))},[m]);const T=()=>{(v.content.length>0||v.attachments.length>0)&&(N.length>1?U("Messages",{action:"createGroup",members:N,content:v.content,attachments:v.attachments}).then(l=>{l&&(s({isGroup:!0,members:N,lastMessage:v.content,timestamp:Date.now(),id:l}),h("messages"),$(!1))}):U("Messages",{action:"sendMessage",number:N[0].number,content:v.content,attachments:v.attachments}).then(l=>{l&&(s({...N[0],lastMessage:v.content,timestamp:Date.now(),id:l}),h("messages"),$(!1))}))};return S.useEffect(()=>{if(b.length>0){if(M){const l=M.filter(f=>{let I=Q(f.firstname,f.lastname);return I&&I.toLowerCase().includes(b.toLowerCase())&&!f.company});V(l)}}else V([])},[b]),o("div",{className:"new-message-container",children:[o("div",{className:"new-message-header",children:[e("span",{}),e("div",{className:"title",children:c("APPS.MESSAGES.NEW_MESSAGE")}),e("div",{className:"button",onClick:()=>{N.length>0&&(v.content.length>0||v.attachments.length>0)?T():$(!1)},children:N.length>0&&(v.content.length>0||v.attachments.length>0)?c("APPS.MESSAGES.SEND"):c("APPS.MESSAGES.CANCEL")})]}),o("div",{className:"new-message-body",children:[o("div",{className:"new-message-search",children:[o("div",{className:"to",children:[c("APPS.MESSAGES.TO"),":"]}),e("div",{className:"contacts",children:N.map((l,f)=>{let I=Q(l.firstname,l.lastname),x=I!=="Unknown";return e("div",{className:`contact ${x?"green":"blue"}`,onClick:()=>{Y.PopUp.set({title:c("APPS.MESSAGES.REMOVE_POPUP.TITLE"),description:c("APPS.MESSAGES.REMOVE_POPUP.TEXT").format({NAME:I??_(l.number)}),buttons:[{title:c("APPS.MESSAGES.CANCEL")},{title:c("APPS.MESSAGES.REMOVE_POPUP.REMOVE"),color:"red",cb:()=>{let j=N.filter(y=>y.number!==l.number);P(j)}}]})},children:x?I:_(l.number)},f)})}),e(K,{type:"text",ref:G,onChange:l=>{if(w(l.target.value),l.target.value.length==g.length&&/^\d+$/g.test(l.target.value)){if(l.target.value===g)return;P([...N,{number:l.target.value}]),G.current.value="",w("")}},onKeyDown:l=>{var f;l.key=="Backspace"&&b.length==0?((f=N[N.length-1])==null?void 0:f.name)===void 0?(G.current.value=N[N.length-1].number,P(N.slice(0,N.length-1))):P(N.slice(0,-1)):l.key=="Tab"&&(l.preventDefault(),k.length==1&&(P([...N,k[0]]),G.current.value="",w("")))}})]}),e("div",{className:"search-results",children:k&&k.filter(l=>!N.find(f=>f.number==l.number)).map((l,f)=>{let I=Q(l.firstname,l.lastname);return o("div",{className:"contact",onClick:()=>{N.find(j=>j.number==l.number)||(P([...N,l]),G.current.value="",w(""))},children:[e("img",{src:l.avatar??"./assets/img/no-pfp.png"}),o("div",{className:"user",children:[e("div",{className:"name",children:I}),e("div",{className:"number",children:_(l.number)})]})]},f)})})]}),N.length>0&&k.length===0&&e("div",{className:"message-bottom absolute",children:e("div",{className:"upper",children:o("div",{className:"input",children:[e(K,{placeholder:c("APPS.MESSAGES.PLACEHOLDER"),value:v.content,onChange:l=>{A({content:l.target.value??"",attachments:v.attachments})},onKeyDown:l=>{l.key=="Enter"&&T()}}),(v.content.length>0||v.attachments.length>0)&&e("div",{className:"send",onClick:()=>T(),children:e(Ee,{})})]})})})]})}function qe(){const{User:t,View:n,Newmessage:d,UnreadMessages:E,ImportedUser:i}=S.useContext(B),s=L(H.PhoneNumber),r=L(H.App),[h,m]=t,[C,g]=n,[O,$]=i,[M,N]=d,[P,G]=E,b=L(ie.APPS.PHONE.contacts),[w,k]=S.useState(""),[V,v]=S.useState([]);return S.useEffect(()=>{U("Messages",{action:"getRecentMessages"}).then(A=>{let T=A.map(l=>{if(l.isGroup)l.members=l.members.filter(f=>f.number!==s).map(f=>{let I=b.find(x=>x.number===f.number);return I?{name:I.name,avatar:I.avatar,number:f.number,isOwner:f.isOwner}:{number:f.number,isOwner:f.isOwner}});else{let f=b.find(I=>I.number===l.number);l.name=f!=null&&f.lastname?`${f.firstname} ${f.lastname}`:f==null?void 0:f.firstname,l.avatar=f==null?void 0:f.avatar}return l});if(r!=null&&r.data&&r.view=="messages"){let l=T.find(f=>f.number===r.data.number);l?(m(l),g("messages")):(N(!0),$({number:r.data.number,firstname:r.data.firstname,lastname:r.data.lastname,avatar:r.data.avatar})),H.App.set({name:r.name})}G(T.filter(l=>l.unread).length),v(T)})},[]),W("messages:newMessage",A=>{let T=JSON.parse(JSON.stringify(V)),l=T.findIndex(f=>f.id===A.id);settings.airplaneMode||(l!==-1&&T.unshift(T.splice(l,1)[0]),T[0].lastMessage=A.content,T[0].timestamp=new Date,v(T))}),o(J,{children:[M&&e(Be,{}),o("div",{className:`animation-slide ${V.length>0?"right":""}`,children:[o("div",{className:"messages-header",children:[e("div",{className:"title",children:c("APPS.MESSAGES.TITLE")}),e(Te,{onClick:()=>N(!0)})]}),e(ge,{placeholder:c("SEARCH"),onChange:A=>k(A.target.value)}),e("div",{className:"users-list",children:V.filter(A=>{var T;return(A.isGroup?A.members.find(l=>{var f;return((f=l.name)==null?void 0:f.toLowerCase().includes(w.toLowerCase()))||l.number.includes(w)}):((T=A.name)==null?void 0:T.toLowerCase().includes(w.toLowerCase()))||A.number.includes(w))||A.lastMessage.toLowerCase().includes(w.toLowerCase())}).map((A,T)=>e(Qe,{user:A,onClick:()=>{m(A),g("messages"),A.unread&&(U("Messages",{action:"markRead",id:A.id}),G(l=>l-1))}},T))})]})]})}const Qe=({user:t,onClick:n})=>{const d=L(z);let E;if(t.isGroup?t.name?E=t.name:E=t.members.sort((i,s)=>i.name&&!s.name?-1:!i.name&&s.name?1:i.name<s.name?-1:i.name>s.name?1:0).map((i,s)=>{if(s<2)return i.name?i.name:_(i.number);if(s===2)return`+${t.members.length-2} ${c("APPS.MESSAGES.OTHER").toLowerCase()}`}).join(" "):E=t.name,t.lastMessage==="Attachment"&&(t.lastMessage=c("APPS.MESSAGES.SENT_A_PHOTO")),/<!SENT-PAYMENT-(\d*)!>/.test(t.lastMessage)){let i=t.lastMessage.match(/\d/g).join("");t.lastMessage=`${c("APPS.MESSAGES.SENT")} ${d.CurrencyFormat.replace("%s",i)}`}else if(/<!REQUESTED-PAYMENT-(\d*)!>/.test(t.lastMessage)){let i=t.lastMessage.match(/\d/g).join("");t.lastMessage=`${c("APPS.MESSAGES.REQUESTED")} $${i}`}else if(/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(t.lastMessage))t.lastMessage=`${c("APPS.MESSAGES.SENT_LOCATION_SHORT")}`;else if(t.lastMessage.startsWith('<!AUDIO-MESSAGE-IMAGE="'))t.lastMessage="sent an audio message";else if(t.lastMessage==="<!CALL-NO-ANSWER!>")t.lastMessage=`${_(t.number)} tried to call you`;else if(t.lastMessage==="")return;return o("div",{className:"user",onClick:()=>n(),children:[e("div",{className:`read${t.unread?" unread":""}`}),t.isGroup?e("div",{className:"avatar group",children:t.members.map((i,s)=>{if(s<=4)return i.avatar?e("div",{style:{backgroundImage:`url(${i.avatar})`}},s):i.name?e("div",{children:i.name.charAt(0)},s):e("div",{className:"unknown"},s)})}):e("img",{className:"avatar",src:t.avatar??"assets/img/no-pfp.png"}),o("div",{className:"user-body",children:[o("div",{className:"user-header",children:[e("div",{className:"name",children:E??_(t.number)}),o("div",{className:"right",children:[e("div",{className:"time",children:Oe(t.timestamp)}),e(Ge,{})]})]}),e("div",{className:"content",children:t.lastMessage.length>40?t.lastMessage.substring(0,40)+"...":t.lastMessage})]})]})},fe=(t,n=25,d=7,E=360,i=120)=>new Promise((s,r)=>{let h=document.createElement("canvas");h.width=E,h.height=i;let m=h.getContext("2d");m.fillStyle="#000";let C=new AudioContext;t.arrayBuffer().then(g=>C.decodeAudioData(g)).then(g=>{let O=(h.width-(n-1)*d)/n,$=h.height/2,M=Math.floor(g.length/n),N=g.getChannelData(0);for(let P=0;P<n;P++){let G=1,b=.1;for(let V=0;V<M;V++){let v=N[P*M+V];v<G&&(G=v),v>b&&(b=v)}let w=(1+G)*$,k=(b-G)*$;m.beginPath(),m.moveTo(P*(O+d),w),m.lineTo(P*(O+d),w+k),m.lineTo(P*(O+d)+O,w+k),m.lineTo(P*(O+d)+O,w),m.closePath(),m.fill()}h.toBlob(P=>s({blob:P,base64:h.toDataURL()}))})});class We{constructor(){ne(this,"mute",()=>{this.recorder&&this.recorder.stream.getTracks().forEach(n=>n.enabled=!1)});ne(this,"unmute",()=>{this.recorder&&this.recorder.stream.getTracks().forEach(n=>n.enabled=!0)});this.recorder=null,this.chunks=[]}start(n){this.recorder=new MediaRecorder(n),this.recorder.ondataavailable=d=>this.chunks.push(d.data),this.chunks=[],this.recorder.start(),U("isTalking").then(d=>{d?this.unmute():this.mute()})}stop(){const{recorder:n,chunks:d}=this;return new Promise(E=>{n.onstop=()=>{const i=new Blob(d,{type:n.mimeType}),s=new Audio;s.src=URL.createObjectURL(i);let r={blob:i};fe(i).then(h=>{fe(i,60,7,960,200).then(m=>{r.waveform={message:h.blob,placeholder:m.base64},s.duration===1/0?(s.currentTime=Number.MAX_SAFE_INTEGER,s.ontimeupdate=()=>E({...r,duration:Math.floor(s.duration+.5)})):E({...r,duration:Math.floor(s.duration+.5)})})})},n.stop()})}}function Ke(){const{User:t,View:n,UnreadMessages:d}=S.useContext(B),E=L(H.Settings),i=L(H.PhoneNumber),[s,r]=t,[h,m]=n,[C,g]=d,O=L(Y.Emoji),[$,M]=S.useState(!1),[N,P]=S.useState(!1),[G,b]=S.useState(!1),[w,k]=S.useState(!1),[V,v]=S.useState(0),[A,T]=S.useState(0),[l,f]=S.useState(!1),[I,x]=S.useState(!1),[j,y]=S.useState([]),[F,Z]=S.useState(null),ee=S.useRef(null),[R,q]=S.useState({content:"",attachments:[]}),te=L(z);S.useEffect(()=>{U("Messages",{action:"getMessages",page:0,id:s.id}).then(a=>{if(a&&a.length>0){y([...a.reverse()]);let u=document.querySelector(".message-container");u.scrollTop=u.scrollHeight}else f(!0)})},[]);const se=S.useRef(!1),le=()=>{if(R.content.length>0||R.attachments.length>0||F){let a={sender:i,timestamp:new Date,id:s.id};if(E.airplaneMode)return y(u=>[...u,{...a,delivered:!1}]);if(F){if(se.current)return;se.current=!0,me("Image",F.waves.message).then(u=>{me("Audio",F.blob).then(D=>{a.content=`<!AUDIO-MESSAGE-IMAGE="${u}"-AUDIO="${D}"-DURATION="${F.duration}"!>`,U("Messages",{action:"sendMessage",number:s.number,content:a.content,id:s.id}).then(p=>{y(p?X=>[...X,a]:X=>[...X,{...a,delivered:!1}]),se.current=!1,Z(null)})})});return}else a={...a,content:R.content,attachments:R.attachments};if(F)return;U("Messages",{action:"sendMessage",number:s.number,content:R.content,attachments:R.attachments,id:s.id}).then(u=>{u?(y(D=>[...D,a]),Z(null)):y(D=>[...D,{...a,delivered:!1}]),q({content:"",attachments:[]}),ee.current&&(ee.current.value="")})}},ce=a=>{if(!(!a&&a<=0)){if(a>(te.MaxTransferAmount??Number.MAX_SAFE_INTEGER))return console.log("cant send");Y.PopUp.set({title:c("APPS.MESSAGES.PAY.SEND_TITLE").format({amount:te.CurrencyFormat.replace("%s",a)}),description:c("APPS.MESSAGES.PAY.SEND_DESCRIPTION").format({amount:te.CurrencyFormat.replace("%s",a),name:s.name??_(s.number)}),buttons:[{title:c("APPS.MESSAGES.PAY.SEND_BUTTON_CANCEL")},{title:c("APPS.MESSAGES.PAY.SEND_BUTTON_SEND"),cb:()=>{U("Wallet",{action:"sendPayment",number:s.number,amount:a}).then(u=>{if(!u.success)return;let D={sender:i,content:`<!SENT-PAYMENT-${a}!>`,attachments:[],timestamp:new Date};y(p=>[...p,D])})}}]})}},Pe=a=>{if(!a&&a<=0)return;let u={sender:i,content:`<!REQUESTED-PAYMENT-${a}!>`,attachments:[],timestamp:new Date};U("Messages",{action:"sendMessage",number:s.number,content:u.content,attachments:[]}).then(D=>{y(D?p=>[...p,u]:p=>[...p,{...u,delivered:!1}])})},ae=()=>{Y.PopUp.set({title:c("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:c("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:c("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:c("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{U("Maps",{action:"getCurrentLocation"}).then(a=>{if(!a)return;let u={sender:i,content:`<!SENT-LOCATION-X=${ue(a.x,2)}Y=${ue(a.y,2)}!>`,attachments:[],timestamp:new Date,id:s.id};U("Messages",{action:"sendMessage",number:s.number,content:u.content,attachments:u.attachments,id:u.id}).then(D=>{y(D?p=>[...p,u]:p=>[...p,{...u,delivered:!1}])})})}}]})},Ae=a=>{if(l||I)return;let u=document.querySelector("#last");if(!u)return;!ye(u)&&(x(!0),U("Messages",{action:"getMessages",page:A+1,id:s.id}).then(p=>{p&&p.length>0?(y([...p.reverse(),...j]),x(!1)):f(!0)}),T(p=>p+1))};W("messages:newMessage",a=>{if(s.id!==a.id||E.airplaneMode)return;y([...j,{...a,timestamp:new Date}]);let u=document.querySelector(".message-container");u.scrollTop=u.scrollHeight}),W("messages:renameGroup",a=>{s.id===a.id&&(E.airplaneMode||r(u=>({...u,name:a.name})))}),W("messages:messageDeleted",a=>{a&&(E.airplaneMode||y(j.filter(u=>u.id!==a)))});const Me=Ue(a=>{let u=a.target;for(;!u.classList.contains("message");)u=u.parentElement;let D=u.getAttribute("data-id");if(!D)return;let p=j.find(X=>X.id===D);p&&p.sender===i&&(oe(p.content)||pe(p.content)||de(p.content)||Y.ContextMenu.set({buttons:[{title:c("APPS.MESSAGES.DELETE"),color:"red",cb:()=>{U("Messages",{action:"deleteMessage",id:D}).then(X=>{})}}]}))}),pe=a=>{if(a)return/<!SENT-PAYMENT-(\d*)!>/.test(a)?!0:!!/<!REQUESTED-PAYMENT-(\d*)!>/.test(a)},oe=a=>{if(a)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(a)},de=a=>{if(a)return a==="<!CALL-NO-ANSWER!>"},be=a=>{if(a)return/<!AUDIO-MESSAGE-IMAGE="(.*)"-AUDIO="(.*)"-DURATION="(.*)"!>/.test(a)};return e(J,{children:o("div",{className:"animation-slide left",children:[$&&e(st,{setShow:M,setShowUserInfo:P,sendLocation:ae,setData:r,data:s}),N&&e(tt,{setShow:P,sendLocation:ae,setUser:r,user:s!=null&&s.isGroup?N:s}),o("div",{className:"message-header",children:[o("div",{className:"back",onClick:()=>{m("userlist"),r(null),s.unread&&(U("Messages",{action:"markRead",id:s.id}),g(a=>a-1))},children:[e(Ie,{}),C>0&&e("span",{className:"back-title",children:C})]}),o("div",{className:"user",onClick:()=>{s.isGroup?M(!0):P(!0)},children:[s.isGroup?e("div",{className:"group-avatar",children:s.members.sort((a,u)=>a.avatar?1:-1).map((a,u)=>e("img",{src:a.avatar??"./assets/img/no-pfp.png",alt:""},u)).slice(0,5)}):e("img",{src:s.avatar??"./assets/img/no-pfp.png",className:"avatar"}),e("div",{className:"name",children:s.isGroup?s.name??`${s.members.length} ${c("APPS.MESSAGES.PEOPLE")}`:s.name??_(s.number)})]}),e(De,{className:`facetime ${s.isGroup?"hidden":""}`,onClick:()=>{s.isGroup||Le({number:s.number,videoCall:!0})}})]}),e("div",{className:"message-container",onScroll:Ae,style:w||G?{height:"48%"}:{},children:e("div",{className:"message-body",children:j.map((a,u)=>e(Je,{index:u,messages:j,message:a,longPressEvent:Me,func:{isMissed:de,isLocation:oe,isVoiceMessage:be,pay:ce}}))})}),e("div",{className:"attachments",children:R.attachments.map((a,u)=>o("div",{className:"attachment",children:[Ne(a)?e("video",{src:a,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e("img",{src:a}),e(re,{onClick:()=>{q({...R,attachments:R.attachments.filter((D,p)=>p!==u)})}})]},u))}),o("div",{className:"message-bottom",style:w||G?{height:"18%"}:{},children:[e("div",{className:"upper",children:o("div",{className:"input","data-border":!F,children:[F?o("div",{className:"audio-message",children:[e(re,{onClick:()=>Z(null)}),e("div",{className:"audio-waves",children:e("img",{src:F.waves.placeholder})})]}):e(K,{placeholder:c("APPS.MESSAGES.PLACEHOLDER"),ref:ee,value:R.content,onChange:a=>{q({content:a.target.value,attachments:R.attachments})},onKeyDown:a=>{a.key=="Enter"&&le()}}),(R.content.length>0||R.attachments.length>0||F)&&e("div",{className:"send",onClick:()=>le(),children:e(Ee,{})})]})}),e("div",{className:"actions-wrapper",children:o("div",{className:"actions",children:[e("div",{className:"action",onClick:()=>{if(O)return Y.Emoji.reset();Y.Emoji.set({onSelect:a=>q(u=>({content:`${u.content}${a.emoji}`,attachments:u.attachments}))})},children:e("img",{src:"./assets/img/icons/messages/emoji.png"})}),e("div",{className:"action",onClick:()=>{R.attachments.length<3&&Y.Gallery.set({includeVideos:!0,onSelect:a=>q({...R,attachments:[...R.attachments,a.src]})})},children:e("img",{src:"./assets/img/icons/messages/gallery.png"})}),!s.isGroup&&e("div",{className:"action black",onClick:()=>{b(!1),k(a=>!a)},children:"$"}),e("div",{className:"action",onClick:()=>ae(),children:e(ke,{})}),e("div",{className:"action blue",onClick:()=>{k(!1),b(a=>!a)},children:e(ve,{})})]})}),w&&e(ze,{paymentAmount:V,setPaymentAmount:v,pay:ce,request:Pe}),G&&e(Ze,{onEnd:a=>{a&&(Z({src:URL.createObjectURL(a.blob),blob:a.blob,waves:a.waveform,duration:a.duration}),b(!1))}})]})]})})}const Je=({messages:t,message:n,index:d,longPressEvent:E,func:i})=>{var k,V;const{User:s}=S.useContext(B),r=L(H.Settings),h=L(H.PhoneNumber),[m]=s,C=L(z);let g,O,$,M,N,P,G=d===0?"last":"",b=n.sender===h?"self":"other",w=((k=t[d+1])==null?void 0:k.sender)===h?"self":"other";if(t[d+1]?$=Math.abs(n.timestamp-t[d+1].timestamp)/36e5:w=void 0,m.isGroup)g=(V=m.members.find(v=>v.number===n.sender))==null?void 0:V.name,O=!t[d-1]||t[d-1].sender!==n.sender;else if(n.content)if(i.isMissed(n.content))if(b==="other")n.content=c("APPS.MESSAGES.MISSED_CALL").format({number:n.sender});else return null;else/<!SENT-PAYMENT-(\d*)!>/.test(n.content)?M={amount:n.content.match(/\d/g).join(""),request:!1}:/<!REQUESTED-PAYMENT-(\d*)!>/.test(n.content)&&(M={amount:n.content.match(/\d/g).join(""),request:!0});if(i.isLocation(n.content)){let v=n.content.match(/X=(-?\d*\.?\d*)Y/)[1],A=n.content.match(/Y=(-?\d*\.?\d*)!>/)[1];N={x:v,y:A}}return i.isVoiceMessage(n.content)&&(P={wave:n.content.match(/AUDIO-MESSAGE-IMAGE="([^"]+)"/)[1],src:n.content.match(/AUDIO="([^"]+)"/)[1],duration:n.content.match(/DURATION="([^"]+)"/)[1]}),o("div",{className:`message ${b}`,id:G,"data-id":n.id,...E,children:[O&&b=="other"&&e("div",{className:"user",children:g??_(n.sender)}),n.delivered===!1?o("div",{className:"content-wrapper",children:[M&&e("div",{className:"payment",children:C.CurrencyFormat.replace("%s",M.amount)}),e("div",{className:"content",children:he(n.content)}),e(Re,{})]}):M||N||P?o(J,{children:[N&&o("div",{className:"location",onClick:()=>{H.App.set({name:"Maps",data:{location:[N.y,N.x],name:`${g??_(n.sender)}'s location`,icon:m.avatar}})},children:[e("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}}),b==="other"&&o("div",{className:"sender",children:[g??_(n.sender)," ",c("APPS.MESSAGES.SENT_LOCATION")]})]}),M&&e("div",{className:"payment",children:M.request?o("div",{className:`request ${b}`,children:[o("div",{className:"title",children:[C.CurrencyFormat.replace("%s",M.amount)," ",c("APPS.MESSAGES.PAY.REQUESTED")]}),b==="other"&&e("div",{className:"button",onClick:()=>i.pay(M.amount),children:c("APPS.MESSAGES.PAY.PAY")})]}):e("div",{className:"sent",children:C.CurrencyFormat.replace("%s",M.amount)})}),P&&e(et,{data:P,sender:b})]}):n.content&&e("div",{className:"content",children:he(n.content)}),n.attachments&&n.attachments.length>0&&e("div",{className:"attatchments",children:n.attachments.map((v,A)=>Ne(v)?e("video",{src:v,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:T=>{Y.FullscreenImage.set({display:!0,image:v})}},A):e(_e,{src:v,onClick:()=>{Y.FullscreenImage.set({display:!0,image:v})}},A))}),n.delivered===!1?e("div",{className:"status",children:c("APPS.MESSAGES.NOT_DELIVERED")}):t[d+1]&&$>6?e("div",{className:"date",children:Se(n.timestamp,r.time.twelveHourClock)}):b!==w&&e("div",{className:"date",children:Se(n.timestamp,r.time.twelveHourClock)})]},d)},Ze=({onEnd:t})=>{const[n,d]=S.useState(!1),E=S.useRef(null);return S.useEffect(()=>{E.current=new We},[]),W("camera:toggleMicrophone",i=>{E!=null&&E.current&&(i?E.current.unmute():E.current.mute())}),e("div",{className:"audioMessage-container",children:e("div",{className:"audioMessage-button","data-recording":n,onClick:()=>{var s;if(!((s=navigator.mediaDevices)!=null&&s.getUserMedia)||!(E!=null&&E.current))return console.log("No media devices found");let i=E.current;n?i.stop().then(r=>{t(r),d(h=>!h)}):navigator.mediaDevices.getUserMedia({audio:!0}).then(r=>{i.start(r),d(h=>!h)})},children:n?e(re,{}):e(ve,{})})})},ze=({paymentAmount:t,setPaymentAmount:n,request:d,pay:E})=>{const i=L(z);return o("div",{className:"payment-container",children:[o("div",{className:"payment-wrapper",children:[e("div",{className:"button",onClick:()=>t>0&&n(s=>s-1),children:"-"}),e("div",{className:"amount",children:e(K,{type:"number",value:t,onChange:s=>{s.target.value.match(/^[0-9]+$/)&&s.target.value>0&&s.target.value<(i.MaxTransferAmount??Number.MAX_SAFE_INTEGER)?n(s.target.value):n(0)}})}),e("div",{className:"button",onClick:()=>n(s=>s+1),children:"+"})]}),o("div",{className:"payment-buttons",children:[e("div",{className:"button",onClick:()=>d(t),children:c("APPS.MESSAGES.PAY.REQUEST")}),e("div",{className:"button",onClick:()=>E(t),children:c("APPS.MESSAGES.PAY.SEND")})]})]})},et=({data:t,sender:n})=>{var r;const[d,E]=S.useState(!1),i=S.useRef(null);S.useEffect(()=>{i.current&&(i.current.onended=()=>{E(!1)})},[i]);const s=h=>{h=Math.floor(h);const m=Math.floor(h/60),C=h-m*60;return`${m<10?"0"+m:m}:${C<10?"0"+C:C}`};return o("div",{className:`voice-message ${n}`,children:[e("a",{onClick:()=>{i.current&&(d?(i.current.pause(),i.current.currentTime=0):i.current.play(),E(h=>!h))},children:d?e($e,{}):e(Ve,{})}),e("div",{className:"wave",children:e("img",{src:t.wave,alt:"wave"})}),e("div",{className:"duration",children:s(d&&Math.floor(((r=i.current)==null?void 0:r.currentTime)+.5)!==0?i.current.currentTime:t.duration)}),e("audio",{ref:i,children:e("source",{src:t.src,type:"audio/mpeg"})})]})},tt=({user:t,setShow:n})=>(L(H.PhoneNumber),o("div",{className:"info-panel",children:[e("div",{className:"info-panel-header",children:e("div",{className:"done",onClick:()=>n(!1),children:c("APPS.MESSAGES.DONE")})}),o("div",{className:"info-panel-body",children:[o("div",{className:"info-panel-top",children:[t.avatar?e("div",{className:"profile-image bigger",style:{backgroundImage:`url(${t.avatar})`}}):t.name?e("div",{className:"profile-image bigger",children:Ye(t.name)}):e("img",{src:t.avatar??"./assets/img/no-pfp.png",className:"avatar"}),e("div",{className:"name",children:t.name??_(t.number)})]}),e("div",{className:"items",children:!t.company&&o(J,{children:[t.name&&e("div",{className:"info-section",children:e("div",{className:"item blue",onClick:()=>He(t.number),children:_(t.number)})}),e("div",{className:"info-section",children:t.name?e("div",{className:"item blue",onClick:()=>{Y.Share.set({type:"contact",data:{firstname:t.firstname,lastname:t.lastname,number:t.number,avatar:t.avatar}})},children:c("APPS.PHONE.CONTACTS.SHARE_CONTACT")}):e("div",{className:"item blue",onClick:()=>{H.App.set({name:"Phone",view:"newContact",data:t.number})},children:c("APPS.PHONE.CONTACTS.ADD_CONTACT")})})]})})]})]})),st=t=>{const{View:n}=S.useContext(B),[d,E]=n,[i,s]=S.useState(!1),[r,h]=S.useState(null);let m=t.data,C=!m.members.find(g=>g.isOwner);return o(J,{children:[i&&e(at,{setShow:s,setData:t.setData,members:m.members,id:m.id}),o("div",{className:"info-panel",children:[e("div",{className:"info-panel-header",children:e("div",{className:"done",onClick:()=>{r&&r!==""&&r!==m.name?U("Messages",{action:"renameGroup",id:m.id,name:r}).then(g=>{t.setShow(!1)}):t.setShow(!1)},children:c("APPS.MESSAGES.DONE")})}),o("div",{className:"info-panel-body",children:[o("div",{className:"info-panel-top",children:[e("div",{className:"group-avatar",children:m.members.sort((g,O)=>g.avatar?1:-1).slice(0,10).map(g=>e("img",{src:g.avatar??"./assets/img/no-pfp.png",alt:""}))}),o("div",{className:"members",children:[m.members.length," ",c("APPS.MESSAGES.MEMBERS")]})]}),o("div",{className:"items",children:[e("div",{className:"info-section",children:o("div",{className:"item blue",children:[e(je,{className:"add"}),e(K,{defaultValue:m.name??"Group Name",onChange:g=>h(g.target.value)})]})}),o("div",{className:"info-section",children:[m.members.sort((g,O)=>g.name&&!O.name?-1:!g.name&&O.name?1:g.name<O.name?-1:g.name>O.name?1:0).map(g=>o("div",{className:"item",children:[C&&e(Fe,{className:"remove",onClick:()=>{Y.PopUp.set({title:c("APPS.MESSAGES.REMOVE_POPUP.TITLE"),description:c("APPS.MESSAGES.REMOVE_POPUP.TEXT").format({name:g.name??_(g.number)}),buttons:[{title:c("APPS.MESSAGES.CANCEL")},{title:c("APPS.MESSAGES.REMOVE_POPUP.REMOVE"),color:"red",cb:()=>{U("Messages",{action:"removeMember",number:g.number,id:m.id}).then(O=>{O&&(t.setData($=>{let M=$;return M.members=M.members.filter(N=>N.number!==g.number),M}),t.setShow(!1))})}}]})}}),e("img",{src:g.avatar??"./assets/img/no-pfp.png",alt:""}),e("div",{className:"name",children:g.name??_(g.number)}),e(xe,{className:"info",onClick:()=>{t.setShowUserInfo({...g})}})]})),o("div",{className:"item blue",onClick:()=>s(!0),children:[e(Xe,{className:"add"}),c("APPS.MESSAGES.ADD_MEMBER")]})]}),e("div",{className:"info-section",children:e("div",{className:"item blue",onClick:()=>t.sendLocation(),children:c("APPS.MESSAGES.SHARE_LOCATION")})}),e("div",{className:"info-section",onClick:()=>{Y.PopUp.set({title:c("APPS.MESSAGES.LEAVE_POPUP.TITLE"),description:c("APPS.MESSAGES.LEAVE_POPUP.TEXT"),buttons:[{title:c("APPS.MESSAGES.CANCEL")},{title:c("APPS.MESSAGES.LEAVE_POPUP.LEAVE"),color:"red",cb:()=>{U("Messages",{action:"leaveGroup",id:m.id}).then(g=>{E("userlist"),t.setShow(!1)})}}]})},children:e("div",{className:"item red",children:c("APPS.MESSAGES.LEAVE_GROUP")})})]})]})]})]})},at=t=>{const n=L(H.PhoneNumber),[d,E]=S.useState(""),i=L(ie.APPS.PHONE.contacts);let s=t.members;return o("div",{className:"add-member-container",children:[o("div",{className:"add-member-header",children:[o("div",{className:"top",children:[e("span",{}),e("div",{className:"title",children:c("APPS.MESSAGES.ADD_MEMBER")}),e("div",{className:"button",onClick:()=>t.setShow(!1),children:c("APPS.MESSAGES.CANCEL")})]}),e(ge,{placeholder:c("APPS.MESSAGES.SEARCH"),onChange:r=>E(r.target.value)})]}),e("div",{className:"contacts",children:i.filter(r=>!r.company).sort((r,h)=>r.firstname&&!h.firstname?-1:!r.firstname&&h.firstname?1:r.firstname<h.firstname?-1:r.firstname>h.firstname?1:0).filter(r=>!s.find(h=>h.number===r.number)||r.number===n).filter(r=>{var h,m;return r.firstname.toLowerCase().includes(d.toLowerCase())||((m=(h=r==null?void 0:r.lastname)==null?void 0:h.toLowerCase())==null?void 0:m.includes(d.toLowerCase()))}).map(r=>{let h=Q(r.firstname,r.lastname);return o("div",{className:"contact",onClick:()=>{Y.PopUp.set({title:c("APPS.MESSAGES.ADD_POPUP.TITLE"),description:c("APPS.MESSAGES.ADD_POPUP.TEXT").format({name:h}),buttons:[{title:c("APPS.MESSAGES.CANCEL")},{title:c("APPS.MESSAGES.ADD_POPUP.ADD"),cb:()=>{U("Messages",{action:"addMember",number:r.number,id:t.id}).then(m=>{t.setData(C=>({...C,members:[...C.members,{number:r.number,name:Q(r.firstname,r.lastname),avatar:r.avatar}]})),t.setShow(!1)})}}]})},children:[e("img",{src:r.avatar??"./assets/img/no-pfp.png"}),o("div",{className:"user",children:[e("div",{className:"name",children:h}),e("div",{className:"number",children:_(r.number)})]})]})})})]})};const B=S.createContext(null);function lt(){const[t,n]=S.useState(null),[d,E]=S.useState("userlist"),[i,s]=S.useState(null),[r,h]=S.useState(0),[m,C]=S.useState(!1);return e("div",{className:"messages-container",children:e(B.Provider,{value:{User:[t,n],View:[d,E],Newmessage:[m,C],ImportedUser:[i,s],UnreadMessages:[r,h]},children:d=="userlist"?e(qe,{}):e(Ke,{})})})}export{B as MessagesContext,lt as default};
