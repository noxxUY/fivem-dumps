import{r as S,j as e,F,a as s}from"./jsx-runtime-7cf68bf7.js";import{u as b,f as p,H as B,Q as X,j as _,bm as q,b8 as w,o as J,L as t,G as K,b as M,C as g,B as y,Y as Q,Z as H,_ as Z,a0 as U,N as k,aU as G,w as z,bn as ee,d as x,e as te,M as j,y as ae,bo as ne}from"./Phone-ec5c0d3e.js";function ie(){const{View:c,Data:a}=S.useContext(D),d=b(M.Settings),I=b(M.PhoneNumber),[o,C]=a,[m,E]=c,[f,A]=S.useState(0),[l,h]=S.useState(!1),[n,i]=S.useState(!1),[P,N]=S.useState([]),v=S.useRef(null),[R,L]=S.useState({content:""});S.useEffect(()=>{p("Services",{action:"getMessages",page:0,id:o.id,company:o.job}).then(r=>{if(r&&r.length>0){N([...r.reverse()]);let u=document.querySelector(".chat-container");u.scrollTop=u.scrollHeight}else h(!0)})},[]);const T=()=>{if(R.content.length>0){let r={sender:I,id:o.id,company:o.job,content:R.content,timestamp:new Date};if(d.airplaneMode)return N(u=>[...u,{...r,delivered:!1}]);p("Services",{action:"sendMessage",...r}).then(u=>{N(u?V=>[...V,r]:V=>[...V,{...r,delivered:!1}]),L({content:""}),v.current.value=""})}},W=()=>{g.PopUp.set({title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{p("Maps",{action:"getCurrentLocation"}).then(r=>{if(!r)return;let u={sender:I,content:`<!SENT-LOCATION-X=${y(r.x,2)}Y=${y(r.y,2)}!>`,attachments:[],id:o.id,company:o.job,timestamp:new Date};p("Services",{action:"sendMessage",...u}).then(V=>{N(V?O=>[...O,u]:O=>[...O,{...u,delivered:!1}])})})}}]})},Y=r=>{if(l||n)return;let u=document.querySelector("#last");if(!u)return;!Q(u)&&(i(!0),p("Services",{action:"getMessages",page:f+1,id:o.id,company:o.job}).then(O=>{O&&O.length>0?(N([...O.reverse(),...P]),i(!1),O.length<25&&h(!0)):h(!0)}),A(O=>O+1))};B("services:newMessage",r=>{if(o.id!==r.channelId||r.sender===I||d.airplaneMode)return;N([...P,{...r,timestamp:new Date}]);let u=document.querySelector(".chat-container");u.scrollTop=u.scrollHeight});const $=r=>{if(r)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(r)};return e(F,{children:s("div",{className:"animation-slide left",children:[s("div",{className:"chat-header",children:[e("div",{className:"back",onClick:()=>{E("messages"),C(null)},children:e(X,{})}),s("div",{className:"user",children:[e("img",{src:o.icon??"./assets/img/no-pfp.png",className:"avatar"}),e("div",{className:"name",children:o.company??_(o.number)})]}),e(q,{className:"hidden"})]}),e("div",{className:"chat-container",onScroll:Y,children:e("div",{className:"chat-body",children:P.map((r,u)=>e(se,{index:u,messages:P,message:r,func:{isLocation:$}}))})}),s("div",{className:"chat-bottom",children:[e(w,{onClick:W}),s("div",{className:"input",children:[e(J,{placeholder:t("APPS.MESSAGES.PLACEHOLDER"),ref:v,value:R.content,onChange:r=>{L({content:r.target.value,attachments:R.attachments})},onKeyDown:r=>{r.key=="Enter"&&T()}}),R.content.length>0&&e("div",{className:"send",onClick:T,children:e(K,{})})]})]})]})})}const se=({messages:c,message:a,index:d,func:I})=>{var P;const{Data:o}=S.useContext(D),C=b(M.Settings),m=b(M.PhoneNumber),[E]=o;let f,A,l,h=d===0?"last":"",n=a.sender===m?"self":"other",i=((P=c[d+1])==null?void 0:P.sender)===m?"self":"other";if(c[d+1]?A=Math.abs(a.timestamp-c[d+1].timestamp)/36e5:i=void 0,I.isLocation(a.content)){let N=a.content.match(/X=(-?\d*\.?\d*)Y/)[1],v=a.content.match(/Y=(-?\d*\.?\d*)!>/)[1];l={x:N,y:v}}return s("div",{className:`message ${n}`,id:h,"data-id":a.id,children:[f,a.delivered===!1?s("div",{className:"content-wrapper",children:[e("div",{className:"content",children:H(a.content)}),e(Z,{})]}):l?s("div",{className:"location",onClick:()=>{M.App.set({name:"Maps",data:{location:[l.y,l.x],name:`${_(a.sender)}'s location`,icon:E.icon}})},children:[e("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}}),n==="other"&&s("div",{className:"sender",children:[_(a.sender)," ",t("APPS.MESSAGES.SENT_LOCATION")]})]}):a.content&&e("div",{className:"content",children:H(a.content)}),a.delivered===!1?e("div",{className:"status",children:t("APPS.MESSAGES.NOT_DELIVERED")}):c[d+1]&&A>6?e("div",{className:"date",children:U(a.timestamp,C.time.twelveHourClock)}):n!==i&&e("div",{className:"date",children:U(a.timestamp,C.time.twelveHourClock)})]},d)};function ce(){var C,m,E,f,A,l,h,n;const c=b(k),[a,d]=S.useState({}),[I,o]=S.useState(null);return S.useEffect(()=>{p("Services",{action:"getCompany"}).then(i=>{i&&d(i)})},[]),e("div",{className:"animation-slide right",children:a.job?s("div",{className:"actions-container",children:[a.duty!==void 0&&((m=(C=c==null?void 0:c.Companies)==null?void 0:C.Management)==null?void 0:m.Duty)!==!1&&s("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.DUTY")}),e("div",{className:"content","data-clickable":"true",onClick:()=>{p("Services",{action:"toggleDuty",duty:!a.duty}).then(()=>{d({...a,duty:!a.duty})})},children:e("div",{className:"item single",children:e("div",{className:"value",children:a.duty?t("APPS.SERVICES.GO_OFF_DUTY"):t("APPS.SERVICES.GO_ON_DUTY")})})})]}),a.isBoss&&s(F,{children:[s("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.ACTIONS")}),s("div",{className:"content",children:[s("div",{className:"item",children:[e("div",{className:"title",children:t("APPS.SERVICES.BALANCE")}),e("div",{className:"value",children:c.CurrencyFormat.replace("%s",a.balance)})]}),s("div",{className:"row",children:[((f=(E=c==null?void 0:c.Companies)==null?void 0:E.Management)==null?void 0:f.Deposit)!==!1&&s("div",{className:"item","data-col":2,onClick:()=>{g.PopUp.set({title:t("APPS.SERVICES.DEPOSIT_POPUP.TITLE"),description:t("APPS.SERVICES.DEPOSIT_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.SERVICES.DEPOSIT_POPUP.AMOUNT"),onChange:i=>{o(i)},type:"number"},buttons:[{title:t("APPS.SERVICES.DEPOSIT_POPUP.CANCEL")},{title:t("APPS.SERVICES.DEPOSIT_POPUP.PROCEED"),cb:()=>{o(i=>{/^\d+$/.test(i)&&p("Services",{action:"depositMoney",amount:parseInt(i)}).then(P=>{P&&d({...a,balance:P})})})}}]})},children:[e("div",{className:"title"}),e("div",{className:"value",children:t("APPS.SERVICES.DEPOSIT_POPUP.TITLE")})]}),((l=(A=c==null?void 0:c.Companies)==null?void 0:A.Management)==null?void 0:l.Withdraw)!==!1&&s("div",{className:"item","data-col":2,onClick:()=>{g.PopUp.set({title:t("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:t("APPS.SERVICES.WITHDRAW_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.SERVICES.WITHDRAW_POPUP.AMOUNT"),onChange:i=>{o(i)},type:"number"},buttons:[{title:t("APPS.SERVICES.WITHDRAW_POPUP.CANCEL")},{title:t("APPS.SERVICES.WITHDRAW_POPUP.PROCEED"),cb:()=>{o(i=>{/^\d+$/.test(i)&&p("Services",{action:"withdrawMoney",amount:parseInt(i)}).then(P=>{P&&d({...a,balance:P})})})}}]})},children:[e("div",{className:"title"}),e("div",{className:"value",children:t("APPS.SERVICES.WITHDRAW_POPUP.TITLE")})]})]})]})]}),s("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.MANAGE_EMPLOYEES")}),s("div",{className:"content","data-clickable":c.Companies.Management.Fire!==!1||c.Companies.Management.Promote!==!1||c.Companies.Management.Hire!==!1,children:[((n=(h=c==null?void 0:c.Companies)==null?void 0:h.Management)==null?void 0:n.Hire)!==!1&&e("div",{className:"item single",onClick:()=>{g.PopUp.set({title:t("APPS.SERVICES.HIRE_POPUP.TITLE"),description:t("APPS.SERVICES.HIRE_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.SERVICES.HIRE_POPUP.PLACEHOLDER"),onChange:i=>{o(i)},type:"number"},buttons:[{title:t("APPS.SERVICES.HIRE_POPUP.CANCEL")},{title:t("APPS.SERVICES.HIRE_POPUP.PROCEED"),cb:()=>{o(i=>{if(/^\d+$/.test(i))return p("Services",{action:"hireEmployee",source:parseInt(i)}).then(P=>{P&&d({...a,employees:[...a.employees,{id:P.id,name:P.name,grade:0,gradeLabel:a.grades[0].label,canInteract:!0}]})}),""})}}]})},children:e("div",{className:"value",children:t("APPS.SERVICES.HIRE")})}),a.employees.map((i,P)=>s("div",{className:"item",onClick:()=>{if(!i.canInteract||c.Companies.Management.Fire===!1&&c.Companies.Management.Promote===!1)return;const N=[c.Companies.Management.Promote!==!1&&{title:t("APPS.SERVICES.SET_GRADE"),cb:()=>{setTimeout(()=>{g.ContextMenu.set({buttons:[...a.grades.map((v,R)=>({title:v.label,cb:()=>{p("Services",{action:"setGrade",employee:i.id,grade:v.grade}).then(L=>{L&&d({...a,employees:a.employees.map(T=>(T.id===i.id&&(T.grade=v.grade,T.gradeLabel=v.label),T))})})}}))]})},300)}},c.Companies.Management.Fire!==!1&&{title:t("APPS.SERVICES.FIRE_POPUP.TITLE"),color:"red",cb:()=>{g.PopUp.set({title:t("APPS.SERVICES.FIRE_POPUP.TITLE"),description:t("APPS.SERVICES.FIRE_POPUP.DESCRIPTION").format({name:i.name}),buttons:[{title:t("APPS.SERVICES.FIRE_POPUP.CANCEL")},{title:t("APPS.SERVICES.FIRE_POPUP.PROCEED"),color:"red",cb:()=>{p("Services",{action:"fireEmployee",employee:i.id}).then(()=>{d({...a,employees:a.employees.filter(v=>v.id!==i.id)})})}}]})}}];g.ContextMenu.set({buttons:N.filter(v=>v)})},children:[e("div",{className:"title",children:i.gradeLabel}),e("div",{className:"value",children:i.name})]},P))]})]})]})]}):e("div",{className:"no-job",children:t("APPS.SERVICES.UNEMPLOYED")})})}function le(){const{View:c,Data:a}=S.useContext(D),[d,I]=c,[o,C]=a,m=b(k),[E,f]=S.useState([]);S.useEffect(()=>{p("Services",{action:"getCompanies"}).then(n=>{n&&f(n)})},[]);const A=n=>{var i;!((i=n==null?void 0:n.location)!=null&&i.coords)||!n.name||M.App.set({name:"Maps",data:{location:[n.location.coords.y,n.location.coords.x],name:n.name,icon:n.icon}})},l=(n,i)=>{m.Companies.Enabled&&g.PopUp.set({title:t("APPS.SERVICES.CALL_POPUP.TITLE"),description:t("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:x(n)}),buttons:[{title:t("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:t("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{te({company:n,companylabel:i})}}]})},h=n=>{p("Services",{action:"getChannelId",company:n.job}).then(i=>{i&&(C({icon:n.icon,company:n.name,job:n.job,id:i}),I("chat"))})};return e("div",{className:"animation-slide right",children:e("div",{className:"companies-list",children:E.sort((n,i)=>n.open&&!i.open?-1:!n.open&&i.open?1:0).map((n,i)=>{var P,N,v,R;return s("div",{className:"item","data-open":n.open,children:[s("div",{className:"info",children:[n.icon&&e("div",{className:"icon",children:e("img",{src:n.icon})}),s("div",{className:"company-details",children:[e("div",{className:"title",children:n.name}),s("div",{className:"location",children:[e(G,{})," ",(P=n.location)==null?void 0:P.name]})]})]}),n.open?s("div",{className:"actions",children:[((N=n.location)==null?void 0:N.coords)&&e(w,{onClick:()=>A(n)}),((v=m.Companies)==null?void 0:v.Enabled)!==!1&&n.canCall!==!1&&e(z,{onClick:()=>l(n.job,n.name)}),n.canMessage!==!1&&e(ee,{onClick:()=>h(n)})]}):s("div",{className:"actions",children:[((R=n.location)==null?void 0:R.coords)&&e(w,{onClick:()=>A(n)}),t("APPS.SERVICES.CLOSED")]})]},i)})})})}function oe(){const{View:c,Data:a}=S.useContext(D),d=b(M.PhoneNumber),[I,o]=c,[C,m]=a,[E,f]=S.useState([]);S.useEffect(()=>{p("Services",{action:"getRecentMessages",page:0}).then(l=>{l&&f({personal:[...l.filter(h=>h.number===d)],job:[...l.filter(h=>h.number!==d)]})})},[]);const A=l=>{if(l)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(l)};return e("div",{className:"animation-slide right",children:s("div",{className:"company-messages-container",children:[s("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.YOUR_MESSAGES")}),e("div",{className:"content",children:E.personal&&E.personal.map((l,h)=>s("div",{className:"item",onClick:()=>{m({...C,icon:l.company.icon,company:l.company.name,job:l.company.job,id:l.id}),o("chat")},children:[e("img",{src:l.company.icon}),s("div",{className:"info",children:[s("div",{className:"info-header",children:[e("div",{className:"user",children:x(l.company.name)}),s("div",{className:"right",children:[e("div",{className:"time",children:U(l.timestamp)}),e(j,{})]})]}),e("div",{className:"message",children:A(l.lastMessage)?t("APPS.MESSAGES.SENT_LOCATION_SHORT"):l.lastMessage})]})]},h))})]}),s("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.JOB_MESSAGES")}),e("div",{className:"content",children:E.job&&E.job.map((l,h)=>s("div",{className:"item",onClick:()=>{m({...C,icon:"./assets/img/no-pfp.png",number:l.number,id:l.id}),o("chat")},children:[e("img",{src:"./assets/img/no-pfp.png"}),s("div",{className:"info",children:[s("div",{className:"info-header",children:[e("div",{className:"user",children:_(l.number)}),s("div",{className:"right",children:[e("div",{className:"time",children:U(l.timestamp)}),e(j,{})]})]}),e("div",{className:"message",children:A(l.lastMessage)?t("APPS.MESSAGES.SENT_LOCATION_SHORT"):l.lastMessage})]})]},h+100))})]})]})})}function re(){const{View:c}=S.useContext(D),a=b(k),[d,I]=c,[o,C]=S.useState([{icon:e(G,{}),title:t("APPS.SERVICES.COMPANIES"),value:"companies"},{icon:e(ae,{}),title:t("APPS.SERVICES.MESSAGES"),value:"messages"}]);return S.useEffect(()=>{var m,E;((E=(m=a==null?void 0:a.Companies)==null?void 0:m.Management)==null?void 0:E.Enabled)!==!1&&C([...o,{icon:e(ne,{}),title:t("APPS.SERVICES.ACTIONS"),value:"actions"}])},[]),e("div",{className:"companies-footer",children:o.map((m,E)=>s("div",{className:"item","data-active":d===m.value,onClick:()=>I(m.value),children:[m.icon,m.title]},E))})}const D=S.createContext(null);function Pe(){const[c,a]=S.useState("companies"),[d,I]=S.useState({name:"Lawyer",icon:"https://cdn-icons-png.flaticon.com/512/3135/3135715.png"}),o={companies:e(le,{}),actions:e(ce,{}),messages:e(oe,{}),chat:e(ie,{})};let C={actions:t("APPS.SERVICES.ACTIONS"),messages:t("APPS.SERVICES.MESSAGES"),companies:t("APPS.SERVICES.COMPANIES")};return e(D.Provider,{value:{View:[c,a],Data:[d,I]},children:s("div",{className:"companies-container",children:[c!=="chat"&&e("div",{className:"companies-header",children:e("div",{className:"title",children:C[c]})}),e("div",{className:"companies-body",children:o[c]}),c!=="chat"&&e(re,{})]})})}export{D as ServicesContext,Pe as default};
