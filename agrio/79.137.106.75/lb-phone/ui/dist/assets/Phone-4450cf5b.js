import{r as d,a as n,j as e,F as T}from"./jsx-runtime-7cf68bf7.js";import{u as p,L as t,g as H,C as L,e as I,I as X,f,h as S,i as B,j as g,k as D,m as G,n as R,o as k,b,p as j,q as Y,r as W,t as V,v as q,w as F,x as z,y as J,z as Q,A as Z,B as x,D as ee,E as ae,F as te}from"./Phone-ec5c0d3e.js";function ne(){const{viewContact:P}=d.useContext(_),E=p(S.APPS.PHONE.contacts),[r,o]=d.useState(!1);return n("div",{className:"slide right",children:[e("div",{className:"contacts-header",children:n("div",{className:"items",children:[e("div",{className:"title",children:t("APPS.PHONE.FAVOURITES.TITLE")}),e("span",{onClick:()=>o(!r),children:r?t("APPS.PHONE.DONE"):t("APPS.PHONE.EDIT")})]})}),e("div",{className:"content",children:e("div",{className:"favourite",children:E.filter(i=>i.favourite||i.company).sort((i,h)=>i.company?-1:1).map((i,h)=>{let v=H(i.firstname,i.lastname);return n("div",{className:"item",onClick:()=>{L.PopUp.set({title:t("APPS.PHONE.CALL.CALL_TITLE").format({name:v}),description:t("APPS.PHONE.CALL.CALL_TEXT").format({name:v}),buttons:[{title:t("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:t("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{I({number:i.number,company:i.company,companylabel:i.firstname})}}]})},children:[n("div",{className:"user",children:[r&&!i.company&&e(X,{onClick:u=>{u.stopPropagation(),L.PopUp.set({title:t("APPS.PHONE.FAVOURITES.REMOVE_TITLE"),description:t("APPS.PHONE.FAVOURITES.REMOVE_TEXT"),buttons:[{title:t("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_CANCEL")},{title:t("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_REMOVE"),color:"red",cb:()=>{f("Phone",{action:"toggleFavourite",number:i.number,favourite:!1}).then(a=>{S.APPS.PHONE.contacts.set(E.map(c=>c.number===i.number?{...c,favourite:!c.favourite}:c))})}}]})}}),i.avatar?e("div",{className:"avatar",style:{backgroundImage:`url(${i.avatar})`}}):e("div",{className:"avatar",children:B(i.firstname,i.lastname)}),n("div",{className:"info",children:[v,e("span",{children:g(i.number)})]})]}),e(D,{onClick:u=>{u.stopPropagation(),P(i,"Favourites")}})]},h)})})})]})}function se(){const{Func:P}=d.useContext(G),{View:E,Contact:r}=d.useContext(_),o=p(b.PhoneNumber),[i]=r,[h,v]=E,u=p(S.APPS.PHONE.contacts),a=p(b.Settings),[c,l]=P.TextColor;l(a.display.theme=="dark"?"#ffffff":"#000000");const[s,A]=d.useState({}),[m,y]=d.useState(!1);d.useEffect(()=>{i&&i.number&&A({...s,number:i.number})},[i]),d.useEffect(()=>{s&&(s.firstname&&s.number?y(!0):y(!1))},[s]);const w=()=>{if(!s.number||(s==null?void 0:s.number)===o)return v("Contacts");s.lastname=(s==null?void 0:s.lastname)??"",f("Phone",{action:"saveContact",data:s}).then(O=>{O&&(S.APPS.PHONE.contacts.set([...u,s]),v("Contacts"))})};return n("div",{className:"slide up",children:[e("div",{className:"contacts-header",children:n("div",{className:"items",children:[e("div",{className:"back",onClick:()=>{v("Contacts")},children:t("APPS.PHONE.CANCEL")}),e("span",{className:m?"":"disabled",onClick:()=>{m&&w()},children:t("APPS.PHONE.DONE")})]})}),e("div",{className:"content",children:e(T,{children:n("div",{className:"contact nohover",children:[e("div",{className:"user",onClick:()=>{L.Gallery.set({onSelect:O=>A({...s,avatar:O.src})})},children:s.avatar?n(T,{children:[e("div",{className:"profile-image bigger transparent",style:{backgroundImage:`url(${s.avatar})`}}),e("span",{children:t("APPS.PHONE.EDIT")})]}):n(T,{children:[e(R,{className:"big"}),e("span",{className:"add",children:t("APPS.PHONE.CONTACTS.ADD_PHOTO")})]})}),n("div",{className:"contact-info",children:[e("div",{className:"item input",children:e(k,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.FIRST_NAME"),onChange:O=>A({...s,firstname:O.target.value}),maxLength:20})}),e("div",{className:"item input",children:e(k,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.LAST_NAME"),onChange:O=>A({...s,lastname:O.target.value}),maxLength:20})})]}),e("div",{className:"contact-info",children:e("div",{className:"item input",children:e(k,{className:"phone_number",type:"number",placeholder:t("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:i==null?void 0:i.number,maxLength:15,onChange:O=>{let U=O.target.value.slice(-1).charCodeAt(0);U>=48&&U<=57&&A({...s,number:O.target.value})}})})})]})})})]})}function ce(){const{View:P,viewContact:E}=d.useContext(_),r=p(b.Settings),[o,i]=P,h=p(b.PhoneNumber),v=p(S.APPS.PHONE.contacts),u=[],[a,c]=d.useState("");return n("div",{className:"slide right",children:[n("div",{className:"contacts-header",children:[n("div",{className:"items",children:[e("div",{className:"title",children:t("APPS.PHONE.CONTACTS.TITLE")}),e(j,{onClick:()=>{i("NewContact")}})]}),e(Y,{placeholder:t("SEARCH"),onChange:l=>c(l.target.value)})]}),n("div",{className:"content",children:[e("div",{className:"letters",children:[...Array(26)].map((l,s)=>{let A=String.fromCharCode(s+65);return e("a",{children:A},s)})}),e("div",{className:"contact nohover",onClick:()=>{E({firstname:r==null?void 0:r.name,number:h},"Contacts")},children:n("div",{className:"profile",children:[r!=null&&r.avatar?e("img",{src:r==null?void 0:r.avatar,alt:"avatar"}):e("div",{className:"profile-image",children:r==null?void 0:r.name.split(" ").map(l=>{var s;return(s=l==null?void 0:l[0])==null?void 0:s.toUpperCase()}).join("")}),n("div",{className:"profile-info",children:[e("div",{className:"name",children:r==null?void 0:r.name}),e("div",{className:"info",children:t("APPS.PHONE.CONTACTS.MY_CARD")})]})]})}),v&&n(T,{children:[v.filter(l=>H(l.firstname,l.lastname).toLowerCase().includes(a.toLowerCase())).sort((l,s)=>l.firstname.localeCompare(s.firstname)).map((l,s)=>{let A=l.firstname.charAt(0).toUpperCase();return u.includes(A)?e("div",{className:"contact border",onClick:()=>E(l,"Contacts"),children:H(l.firstname,l.lastname)}):(u.push(A),n("div",{children:[e("div",{id:A,className:`divider ${u.length==1?"no-border":""}`,children:A}),e("div",{className:"contact border",onClick:()=>E(l,"Contacts"),children:H(l.firstname,l.lastname)})]},s))}),n("div",{className:"total-contacts",children:[v.length," ",t("APPS.PHONE.CONTACTS.TITLE")]})]})]})]})}function ie(){const{viewContact:P}=d.useContext(_),[E,r]=d.useState([]);return d.useEffect(()=>{f("Phone",{action:"getRecent",page:0}).then(o=>{o&&r(o)})},[]),n("div",{className:"slide right",children:[e("div",{className:"contacts-header",children:e("div",{className:"items",children:e("div",{className:"title",children:t("APPS.PHONE.RECENTS.TITLE")})})}),e("div",{className:"content",children:e("div",{className:"recent-calls",children:E.map((o,i)=>n("div",{className:`item${!o.called&&!o.answered?" missed":""}`,onClick:()=>{if(o.hideCallerId)return;let h;o.name?h=o.name:h=g(o.number),L.PopUp.set({title:t("APPS.PHONE.CALL.CALL_TITLE").format({name:h}),description:t("APPS.PHONE.CALL.CALL_TEXT").format({name:h}),buttons:[{title:t("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:t("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{I({name:o.name,number:o.number})}}]})},children:[e("div",{className:"user",children:o.hideCallerId?n(T,{children:[t("APPS.PHONE.CALL.NO_CALLER_ID"),e("span",{children:t("APPS.PHONE.CALL.UNKNOWN")})]}):o.name?n(T,{children:[o.name,e("span",{children:g(o.number)})]}):n(T,{children:[g(o.number),e("span",{children:t("APPS.PHONE.CALL.UNKNOWN")})]})}),n("div",{className:"info",children:[e("div",{className:"date",children:W(o.timestamp)}),e(D,{onClick:h=>{if(h.stopPropagation(),!o.hideCallerId)if(o.name){let v=V(o.number);v&&P({...v,number:o.number},"Recents")}else P({...o},"Recents")}})]})]},i))})})]})}function re(){const{View:P,Contact:E,viewContact:r}=d.useContext(_),[o,i]=P,[h,v]=E,[u,a]=d.useState(null),[c,l]=d.useState("");d.useEffect(()=>(document.addEventListener("keydown",A),()=>document.removeEventListener("keydown",A)),[c]);const s=m=>{m=="delete"?l(c.slice(0,-1)):l(c+m)},A=m=>{if(m.key.match(/^[0-9]+$/))s(m.key);else switch(m.key){case"Backspace":s("delete");break;case"Enter":c.length>=3&&I({number:c});break}};return d.useEffect(()=>{if(c.length!==q())return a(null);a(V(c))},[c]),e("div",{className:"slide right",children:e("div",{className:"content noscroll",children:n("div",{className:"keypad-container",children:[n("div",{className:"inputbox",children:[e("div",{className:"input",children:g(c)}),e("span",{onClick:()=>{if(l(""),u)r(u,"Keypad");else{let m=V(c);m?(v({...m,number:c}),i("NewContact")):(v({number:c}),i("NewContact"))}},children:c.length>0&&(u?u.name:t("APPS.PHONE.KEYPAD.ADD_NUMBER"))})]}),e("div",{className:"keypad-wrapper",children:n("div",{className:"keypad",children:[e("div",{onClick:()=>{s(1)},children:"1"}),n("div",{onClick:()=>{s(2)},children:["2",e("span",{children:"ABC"})]}),n("div",{onClick:()=>{s(3)},children:["3",e("span",{children:"DEF"})]}),n("div",{onClick:()=>{s(4)},children:["4",e("span",{children:"GHI"})]}),n("div",{onClick:()=>{s(5)},children:["5",e("span",{children:"JKL"})]}),n("div",{onClick:()=>{s(6)},children:["6",e("span",{children:"MNO"})]}),n("div",{onClick:()=>{s(7)},children:["7",e("span",{children:"PQRS"})]}),n("div",{onClick:()=>{s(8)},children:["8",e("span",{children:"TUV"})]}),n("div",{onClick:()=>{s(9)},children:["9",e("span",{children:"WYXZ"})]}),e("div",{children:"*"}),n("div",{onClick:()=>{s(0)},children:["0",e("span",{children:"+"})]}),e("div",{children:"#"}),e("span",{}),e("div",{className:"call",onClick:()=>{c.length>=3&&I({number:c})},children:e(F,{})}),e("div",{className:"delete",onClick:()=>s("delete"),children:e(z,{})})]})})]})})})}function le(){const{View:P,Contact:E}=d.useContext(_),r=p(b.Settings),o=p(b.PhoneNumber),[i,h]=d.useState(E.number),[v,u]=P,[a,c]=E,l=p(S.APPS.PHONE.contacts),[s,A]=d.useState(!1),[m,y]=d.useState(!1),w=()=>{f("Phone",{action:"removeContact",number:a.number}).then(N=>{S.APPS.PHONE.contacts.set(l.filter(C=>C.number!==a.number)),c(null),u("Contacts")})},O=()=>{f("Phone",{action:"toggleBlock",number:a.number,blocked:!a.blocked}).then(N=>{c({...a,blocked:!a.blocked}),S.APPS.PHONE.contacts.set(l.map(C=>C.number===a.number?{...C,blocked:!C.blocked}:C))})},U=()=>{f("Phone",{action:"toggleFavourite",number:a.number,favourite:!a.favourite}).then(N=>{c({...a,favourite:!a.favourite}),S.APPS.PHONE.contacts.set(l.map(C=>C.number===a.number?{...C,favourite:!C.favourite}:C))})},K=()=>{if(!a.number||a.number.length===0)return u("Contacts");a.number===o?(b.Settings.patch({name:a.firstname,avatar:a.avatar??r.avatar}),f("setPhoneName",a.firstname),f("setSettings",b.Settings.value),A(N=>!N),S.APPS.PHONE.contacts.set(l.map(N=>N.number===a.number?{...N,...a}:N))):(a.lastname=a.lastname??"",f("Phone",{action:"updateContact",data:{...a,oldNumber:i}}).then(N=>{A(C=>!C),S.APPS.PHONE.contacts.set(l.map(C=>C.number===a.number?{...C,...a}:C)),h(a.number)}))},$=()=>{a&&L.PopUp.set({title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{f("Maps",{action:"getCurrentLocation"}).then(N=>{N&&f("Messages",{action:"sendMessage",number:a.number,content:`<!SENT-LOCATION-X=${x(N.x,2)}Y=${x(N.y,2)}!>`,attachments:[]}).then(C=>{C?b.App.set({name:"Messages",data:{number:a.number,name:a.firstname&&H(a.firstname,a.lastname),avatar:a.avatar},view:"messages"}):console.log("something went wrong")})})}}]})},M=d.useRef(!0);return d.useEffect(()=>{M.current&&M.current&&(h(a.number),M.current=!1,y(a.number===o))},[a]),n("div",{className:"slide left",children:[e("div",{className:"contacts-header",children:n("div",{className:"items",children:[s?e("span",{}):n("div",{className:"back",onClick:()=>{u(a.from),c(null)},children:[e("i",{className:"fal fa-chevron-left"}),t(`APPS.PHONE.${a.from.toUpperCase()}.TITLE`)]}),a.firstname&&!a.company&&e("span",{onClick:()=>{s?K():A(N=>!N)},children:s?t("APPS.PHONE.DONE"):t("APPS.PHONE.EDIT")})]})}),e("div",{className:"content",children:s?e(T,{children:n("div",{className:"contact nohover",children:[n("div",{className:"user",onClick:()=>{L.Gallery.set({onSelect:N=>c({...a,avatar:N.src})})},children:[a.avatar||m&&r.avatar?e("div",{className:"profile-image bigger",style:{backgroundImage:`url(${a.avatar??r.avatar})`}}):a.firstname?e("div",{className:"profile-image bigger",children:B(a.firstname,a.lastname)}):e(R,{}),e("span",{children:t("APPS.PHONE.EDIT")})]}),n("div",{className:"contact-info",children:[e("div",{className:"item input",children:e(k,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.FIRST_NAME"),value:a.firstname,onChange:N=>c({...a,firstname:N.target.value}),maxLength:20})}),!m&&e("div",{className:"item input",children:e(k,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.LAST_NAME"),value:a.lastname??"",onChange:N=>c({...a,lastname:N.target.value}),maxLength:20})})]}),e("div",{className:"contact-info",children:e("div",{className:"item input",children:e(k,{className:"phone_number",type:"number",placeholder:t("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:a==null?void 0:a.number,maxLength:20,disabled:m,onChange:N=>{if(m)return;let C=N.target.value.slice(-1).charCodeAt(0);C>=48&&C<=57&&N.target.value.length<=10&&c({...a,number:N.target.value})}})})}),!m&&e("div",{className:"contact-info",children:e("div",{className:"item red",onClick:()=>{L.PopUp.set({title:t("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TITLE"),description:t("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TEXT"),buttons:[{title:t("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_CANCEL")},{title:t("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_DELETE"),color:"red",cb:w}]})},children:t("APPS.PHONE.CONTACTS.DELETE_CONTACT")})})]})}):e(T,{children:n("div",{className:"contact nohover details",children:[n("div",{className:"user",children:[a.avatar||m&&r.avatar?e("div",{className:"profile-image bigger",style:{backgroundImage:`url(${m?r.avatar:a.avatar})`}}):a.firstname?e("div",{className:"profile-image bigger",children:B(a.firstname,a.lastname)}):e(R,{}),e("div",{className:"name",children:a.firstname?H(a.firstname,a.lastname):g(a.number)})]}),n("div",{className:"actions",children:[n("div",{className:"item","data-disabled":!!(m||a.company),onClick:()=>{b.App.set({name:"Messages",data:{number:a.number,name:a.firstname&&H(a.firstname,a.lastname),avatar:a.avatar},view:"messages"})},children:[e(J,{}),t("APPS.PHONE.CONTACTS.MESSAGE")]}),n("div",{className:"item call","data-disabled":m,onClick:()=>{I({number:a.number,company:a.company,companylabel:a.company&&a.firstname})},children:[e(F,{}),t("APPS.PHONE.CONTACTS.CALL")]}),n("div",{className:"item","data-disabled":!!(m||a.company),onClick:()=>{I({number:a.number,company:a.company,companylabel:a.company&&a.firstname,videoCall:!0})},children:[e(Q,{}),t("APPS.PHONE.CONTACTS.VIDEO")]})]}),!a.company&&n(T,{children:[e("div",{className:"contact-info",children:n("div",{className:"item",onClick:()=>Z(a.number),children:[e("div",{className:"title",children:t("APPS.PHONE.CONTACTS.MAIN")}),e("div",{className:"value",children:g(a.number)})]})}),e("div",{className:"contact-info",children:a.firstname?n(T,{children:[e("div",{className:"item",onClick:()=>{L.Share.set({type:"contact",data:{firstname:a.firstname,lastname:a.lastname,number:a.number,avatar:a.avatar??r.avatar}})},children:t("APPS.PHONE.CONTACTS.SHARE_CONTACT")}),!m&&n(T,{children:[e("div",{className:"item",onClick:()=>$(),children:t("APPS.PHONE.CONTACTS.SHARE_LOCATION")}),a.favourite?e("div",{className:"item red",onClick:()=>{U()},children:t("APPS.PHONE.CONTACTS.REMOVE_FAVORITE")}):e("div",{className:"item",onClick:()=>{U()},children:t("APPS.PHONE.CONTACTS.ADD_FAVORITE")})]})]}):e("div",{className:"item",onClick:()=>{u("NewContact")},children:t("APPS.PHONE.CONTACTS.ADD_CONTACT")})}),!m&&e("div",{className:"contact-info",children:a.blocked?e("div",{className:"item red",onClick:()=>{L.PopUp.set({title:t("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TITLE"),description:t("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TEXT").format({number:g(a.number)}),buttons:[{title:t("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_CANCEL")},{title:t("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_UNBLOCK"),cb:()=>{O()}}]})},children:t("APPS.PHONE.CONTACTS.UNBLOCK_CALLER")}):e("div",{className:"item red",onClick:()=>{L.PopUp.set({title:t("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TITLE"),description:t("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TEXT").format({number:g(a.number)}),buttons:[{title:t("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_CANCEL")},{title:t("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_BLOCK"),color:"red",cb:()=>{O()}}]})},children:t("APPS.PHONE.CONTACTS.BLOCK_CALLER")})})]})]})})})]})}const _=d.createContext(null);function me(){const P=p(b.App),[E,r]=d.useState("Contacts"),[o,i]=d.useState(null),h=p(S.APPS.PHONE.contacts),v=(c,l)=>{i({...c,from:l}),r("Contact")};d.useEffect(()=>{if(h&&P!=null&&P.data)if(P.view==="contact"){let c=h==null?void 0:h.find(l=>l.number==P.data);if(!c)return;i({...c||{number:P.data},from:"Contacts"}),r("Contact")}else P.view==="newContact"&&(i({number:P.data,from:"Contacts"}),r("NewContact"))},[]);const u={Favourites:e(ne,{}),Contacts:e(ce,{}),Recents:e(ie,{}),Keypad:e(re,{}),NewContact:e(se,{}),Contact:e(le,{})},a={Favourites:e(ee,{}),Recents:e(ae,{}),Contacts:e(R,{}),Keypad:e(te,{})};return n("div",{className:"phone-app-container",children:[e(_.Provider,{value:{Contact:[o,i],View:[E,r],viewContact:v},children:e("div",{className:"wrapper",children:u[E]})}),e("div",{className:"footer",children:Object.keys(a).map((c,l)=>{let s=E==c?"active":"";return n("div",{className:`item ${s}`,onClick:()=>r(c),children:[a[c],e("span",{children:t(`APPS.PHONE.${c.toUpperCase()}.TITLE`)})]},l)})})]})}export{_ as PhoneContext,me as default};
