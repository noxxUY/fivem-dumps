import{r as a,j as o,a as E,F as b}from"./jsx-runtime-7cf68bf7.js";import{f as N,L as m,au as _,C,Y as H,u as A,aa as M,a8 as D,Q as B,av as U,N as X,b as F,aw as x,B as z}from"./Phone-ec5c0d3e.js";import{C as V}from"./Check-676db25c.js";function Q(){const h=a.useRef(null),[v,S]=a.useState(!1),[i,p]=a.useState([]),[d,T]=a.useState({}),[u,O]=a.useState([]),[f,y]=a.useState(0),[r,I]=a.useState(!1),[w,L]=a.useState(!1),n=c=>{if(c){let l=u.filter(e=>e.src===c)[0];N("Camera",{action:"deleteFromGallery",links:l.src}).then(e=>{O(u.filter(s=>s.src!==c)),T({}),window.postMessage({action:"phone:updateStorage",add:!1,size:l.size})})}else N("Camera",{action:"deleteFromGallery",links:i.map(l=>l.src)}).then(l=>{O(u.filter(s=>!i.find(t=>s.src===t.src))),p([]);let e=0;i.forEach(s=>{e+=parseFloat(s.size)}),window.postMessage({action:"phone:updateStorage",add:!1,size:e})})};a.useEffect(()=>{N("Camera",{action:"getImages",page:0,filter:{showVideos:!0,showPhotos:!0}}).then(c=>{c&&O(c)})},[]);const g=c=>{if(w||r)return;let l=document.querySelector("#last");if(!l)return;!H(l)&&(I(!0),N("Camera",{action:"getImages",page:f+1,filter:{showVideos:!0,showPhotos:!0}}).then(s=>{s&&s.length>0?(O([...u,...s]),I(!1),s.length<25&&L(!0)):L(!0)}),y(s=>s+1))};return o("div",{className:"photos-container",children:Object.keys(d).length===0?E("div",{className:"zoomOut",children:[E("div",{className:"photos-header",children:[o("div",{}),o("div",{className:"title",children:m("APPS.PHOTOS.TITLE")}),o("div",{className:"select",onClick:()=>S(!v),children:v?m("APPS.PHOTOS.CANCEL"):m("APPS.PHOTOS.SELECT")})]}),E("div",{className:"photos-content",onScroll:g,children:[o("div",{className:"images",ref:h,children:u.sort((c,l)=>l.timestamp-c.timestamp).map((c,l)=>{let e=l===u.length-1?"last":"";return E("div",{id:e,className:"image",onClick:()=>{if(v){const s=i.find(t=>t.src===c.src);p(s?i.filter(t=>t.src!==c.src):[...i,c])}else T(c)},children:[c.isVideo?o(R,{src:c.src,editMode:v}):o("div",{className:"img",style:{backgroundImage:`url(${c.src})`},alt:"photo"}),o("div",{className:"checkbox",children:v&&(i.find(s=>s.src===c.src)?o(V,{checked:!0}):o(V,{checked:!1}))})]},l)})}),o("div",{className:"info",children:m("APPS.PHOTOS.PHOTO_COUNT").format({count:u.length})})]}),v&&E("div",{className:"photos-bottom",children:[o("span",{}),o("div",{className:"selected",children:i.length>0?m("APPS.PHOTOS.SELECTED_COUNT").format({count:i.length}):m("APPS.PHOTOS.SELECT_ITEMS")}),i.length>0?o(_,{onClick:()=>{C.PopUp.set({title:m("APPS.PHOTOS.DELETE_TITLE").format({count:i.length}),description:m("APPS.PHOTOS.DELETE_TEXT").format({count:i.length}),buttons:[{title:m("APPS.PHOTOS.DELETE_BUTTON_CANCEL")},{title:m("APPS.PHOTOS.DELETE_BUTTON_DELETE"),color:"red",cb:()=>{n()}}]})}}):o("span",{})]})]}):o(G,{image:d,images:u,setActiveImage:T,handleDelete:n})})}const G=h=>{var l;const v=A(X),S=A(F.Settings),[i,p]=a.useState(new Date(((l=h==null?void 0:h.image)==null?void 0:l.timestamp)/1e3)),[d,T]=a.useState(!0),[u,O]=a.useState(0),f=a.useRef(null),y=a.useRef(null),[r,I]=a.useState(h.image),[w,L]=a.useState([]);let n=h.images;a.useEffect(()=>{if(r&&r.isVideo){const e=document.getElementById(r.src);if(!e)return;e.volume=S.sound.volume}},[S.sound.volume]),a.useEffect(()=>{var s;let e=n.findIndex(t=>t.src===r.src);if(O(e),r.isVideo){const t=document.getElementById(r.src);if(!t)return;t.play(),t.volume=S.sound.volume}if(n.length>0){let t=[];e===0?t=n.slice(0,12):e===n.length-1?t=n.slice(n.length-12,n.length):e<6?t=n.slice(0,12):e>n.length-6?t=n.slice(n.length-12,n.length):t=n.slice(e-6,e+6),p(new Date(((s=n==null?void 0:n[e])==null?void 0:s.timestamp)/1e3)),L(t)}},[r]);const g={pos:{startLeft:0,startX:0},onMouseDown:e=>{g.pos={startLeft:f.current.scrollLeft,startX:e.clientX},f.current.style.userSelect="none",document.addEventListener("mouseup",g.onMouseUp),document.addEventListener("mousemove",g.onMove)},onMove:e=>{if(!f.current)return;const s=(e.clientX-g.pos.startX)/x(S.display.size);f.current.scrollLeft=g.pos.startLeft-s;const t=f.current.getBoundingClientRect();(t.left-5>e.clientX||e.clientX>t.right-5)&&g.onMouseUp()},onMouseUp:e=>{if(!f.current)return;f.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",g.onMouseUp),document.removeEventListener("mousemove",g.onMove);const s=f.current.clientWidth;let t=u;const P=f.current.scrollLeft-g.pos.startLeft;if(P>s/2&&t<n.length?t++:P<-s/2&&t>0&&t--,r.src!==n[t].src&&r.isVideo){const k=document.getElementById(r.src);k&&(k.pause(),k.currentTime=0)}I(n[t]),document.getElementById(n[t].src).scrollIntoView({behavior:"smooth",block:"center"})}},c=e=>{r.isVideo&&document.getElementById(r.src).stop(),I(e),document.getElementById(e.src).scrollIntoView({behavior:"smooth",block:"center"})};return E("div",{className:"activephoto-container",children:[o(M,{mode:"wait",initial:!1,children:d&&E(D.div,{className:"photo-top",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[o("div",{className:"back",onClick:()=>{C.Share.reset(),h.setActiveImage({})},children:o(B,{})}),E("div",{className:"date",children:[i.toLocaleString([],{day:"2-digit",month:"long"}),o("span",{children:i.toLocaleTimeString(v.DateLocale,{hour:"numeric",minute:"numeric",hour12:S.time.twelveHourClock})})]}),o("div",{})]})}),o("div",{className:"image-overflow",ref:f,onMouseDown:g.onMouseDown,onClick:()=>T(!d),children:n.map((e,s)=>{const t=e.src===r.src;return e.isVideo?o("video",{src:e.src,alt:"video",className:t?"active":null,id:e.src,crossOrigin:"anonymous",loop:!0,onLoadedMetadata:P=>{t&&(P.target.scrollIntoView({block:"center"}),P.target.play())}},s):o("img",{id:e.src,src:e.src,alt:"photo",className:t?"active":null,onLoad:P=>{t&&P.target.scrollIntoView({block:"center"})}},s)})}),o(M,{mode:"wait",initial:!1,children:d&&E(D.div,{className:"photo-bottom-wrapper",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[o("div",{className:"photo-carousel",ref:y,children:w.map((e,s)=>e.isVideo?o("video",{src:e.src,"data-carousel":s,controls:!1,muted:!0,onClick:t=>c(e)},s):o("img",{src:e.src,"data-carousel":s,onClick:t=>c(e)},s))}),E("div",{className:"photo-bottom",children:[o(U,{onClick:()=>{C.Share.set({type:"image",data:{src:r.src,isVideo:r.isVideo}})}}),o(_,{onClick:()=>{C.PopUp.set({title:m("APPS.PHOTOS.DELETE_IMAGE_TITLE"),description:m("APPS.PHOTOS.DELETE_IMAGE_TEXT"),buttons:[{title:m("APPS.PHOTOS.DELETE_IMAGE_BUTTON_CANCEL")},{title:m("APPS.PHOTOS.DELETE_IMAGE_BUTTON_DELETE"),color:"red",cb:()=>{h.handleDelete(h.image.src)}}]})}})]})]})})]})},R=({src:h,editMode:v})=>{const[S,i]=a.useState(null);return E(b,{children:[o("video",{src:h,crossOrigin:"anonymous",controls:!1,onMouseOver:d=>d.currentTarget.play(),onMouseOut:d=>d.currentTarget.pause(),muted:!0,onLoadedMetadata:d=>{i(d.currentTarget.duration)}}),S&&!v&&o("div",{className:"video-duration",children:(d=>{const T=Math.floor(d/60),u=z(d-T*60,0);return`${T}:${u<10?"0"+u:u}`})(S)})]})};export{Q as default};
