import{r,a as s,j as a,F as v}from"./jsx-runtime-7cf68bf7.js";import{u as A,f as L,H as w,L as n,o as F,j as b,B as T,aG as x,aH as P,a0 as D,b as O,N as I}from"./Phone-ec5c0d3e.js";import{N as B}from"./Numpad-92ddfc65.js";function j(){const h=A(O.Settings),c=A(I),[l,p]=r.useState({balance:0,transactions:[],bills:[]}),[m,d]=r.useState(!1),[g,M]=r.useState(""),[i,S]=r.useState(0),[C,E]=r.useState(!1),[t,o]=r.useState(""),[N,u]=r.useState(null);r.useEffect(()=>{L("Wallet",{action:"getData"}).then(e=>{e&&p(e)})},[]),r.useEffect(()=>{o(""),S(0)},[m]),w("wallet:addTransaction",e=>{h.airplaneMode||p({...l,balance:l.balance+e.amount,transactions:[{...e,timestamp:Date.now()},...l.transactions].slice(0,5)})}),r.useEffect(()=>{i===0?t.length>3?E(!0):E(!1):i===1&&(t.length>0&&W(parseFloat(t))&&parseFloat(t)<=(c.MaxTransferAmount??Number.MAX_SAFE_INTEGER)?E(!0):E(!1))},[t]);const W=e=>l.balance>=e,k=e=>{if(e=="backspace")return o(f=>f.length>0?f.slice(0,-1):"0");o(f=>f+e)};return r.useEffect(()=>{if(i!==1||t.length>=9)return;const e=document.getElementById("number");e.style.width=`${t.length}ch`,N&&u(null)},[t]),r.useEffect(()=>{u(null)},[i]),s("div",{className:"wallet-app-container",children:[m&&s("div",{className:"send-container",children:[s("div",{className:"send-header",children:[a("div",{onClick:()=>d(!1),children:n("CANCEL")}),i===2?a("div",{onClick:()=>d(!1),children:n("APPS.WALLET.DONE")}):a("div",{className:!C&&"disabled",onClick:()=>{if(C){if(i==0)L("Wallet",{action:"doesNumberExist",number:t}).then(e=>{e?(M(t),S(1),o("")):u(n("APPS.WALLET.NUMBER_DOES_NOT_EXIST"))});else if(i==1){if(!W(parseFloat(t)))return u(n("APPS.WALLET.NOT_ENOUGH_MONEY"));if(parseFloat(t)>(c.MaxTransferAmount??Number.MAX_SAFE_INTEGER))return u("Max transfer amount reached");if(h.airplaneMode)return;L("Wallet",{action:"sendPayment",number:g,amount:Math.floor(parseFloat(t))}).then(e=>{e!=null&&e.success?S(2):u(n("APPS.WALLET.NOT_ENOUGH_MONEY"))})}}},children:n("APPS.WALLET.NEXT")})]}),s("div",{className:"send-wrapper",children:[i===0&&s(v,{children:[a("div",{className:"user",children:a(F,{className:"number_input",type:"number",onChange:e=>o(e.target.value.replace(/[^0-9]/g,"")),value:t,placeholder:b("1234567890")})}),a("div",{className:"description",children:n("APPS.WALLET.NO_REFUNDS")}),N&&a("div",{className:"error",children:N})]}),i===1&&s(v,{children:[s("div",{className:"amount",children:[a("div",{className:"symbol",children:c.CurrencyFormat.replace("%s","")}),a(F,{type:"number",id:"number",value:t,onChange:e=>o(e.target.value.replace(/[^0-9]/g,""))})]}),s("div",{className:"description",children:[n("APPS.WALLET.NEW_BALANCE"),": ",c.CurrencyFormat.replace("%s",""),T(l.balance-parseFloat(t),2)]}),N&&a("div",{className:"error",children:N})]}),i===2&&s("div",{className:"success",children:[a(x,{}),a("div",{className:"title",children:n("APPS.WALLET.DONE")}),a("div",{className:"subtitle",children:n("APPS.WALLET.DONE_SUBTITLE").format({amount:c.CurrencyFormat.replace("%s",t),number:b(g)})})]})]}),i!==2&&a("div",{className:"numpad-wrapper",children:a(B,{cb:e=>k(e)})})]}),s("div",{className:"overview",children:[a("div",{className:"header-title",children:n("APPS.WALLET.TITLE")}),s("div",{className:"wrapper",children:[a("div",{className:"card"}),a("section",{children:s("div",{className:"item space",children:[s("div",{className:"balance",children:[a("div",{className:"title",children:n("APPS.WALLET.BALANCE")}),a(G,{amount:l.balance})]}),a("div",{className:"button",onClick:()=>d(!0),children:n("APPS.WALLET.SEND")})]})}),l.transactions&&l.transactions.length>0&&s(v,{children:[a("div",{className:"subtitle",children:a("div",{className:"title",children:n("APPS.WALLET.LATEST_TRANSACTIONS")})}),a("section",{children:l.transactions.map((e,f)=>{let y=e.amount>0,_=e.company.match(/\d{10}/);return s("div",{className:"item multi",children:[e.logo?a("img",{src:e.logo}):!_&&a("div",{className:"image",children:e.company[0]}),s("div",{className:"info",children:[s("div",{className:"transaction-header",children:[a("div",{className:"title",children:_?b(e.company):e.company}),a("div",{className:"right",children:s("div",{className:`amount ${y?"green":"red"}`,children:[!y&&"-",c.CurrencyFormat.replace("%s",P(Math.abs(e.amount)))]})})]}),a("div",{className:"date",children:D(e.timestamp)})]})]})})})]}),l.bills&&l.bills.length>0&&s(v,{children:[a("div",{className:"subtitle",children:a("div",{className:"title",children:n("APPS.WALLET.LATEST_BILLS")})}),a("section",{})]})]})]})]})}const G=({amount:h})=>{const c=A(I),[l,p]=r.useState(!0),m=A(O.Settings);let d;return l&&(m!=null&&m.streamerMode)?d=P(parseInt("⁎".repeat(T(h,2).toString().length))):d=P(T(h,2)),a("div",{className:"value",onClick:()=>p(!l),children:c.CurrencyFormat.replace("%s",d)})};export{j as default};
